"use strict";var app=angular.module("proximiApp",["ngAnimate","ngCookies","ngResource","ngSanitize","ngTouch","firebase","ui.router","ui.bootstrap","FBAngular","ngTable","ui.select","ui.utils","leaflet-directive","textAngular","decipher.tags","ngStorage","localytics.directives","toastr","angular-momentjs","angular-flot","ez.datetime","easypiechart","lbServices"]);app.config(["$stateProvider","$urlRouterProvider",function($stateProvider,$urlRouterProvider){$urlRouterProvider.otherwise("/app/dashboard"),$stateProvider.state("app",{"abstract":!0,url:"/app",templateUrl:"views/app.html"}).state("app.dashboard",{url:"/dashboard",controller:"DashboardCtrl",templateUrl:"views/pages/dashboard.html",authenticate:!0}).state("app.places",{url:"/places",controller:"PlacesCtrl",templateUrl:"views/pages/places.html",authenticate:!0}).state("app.floors",{url:"/floors",controller:"FloorsCtrl",templateUrl:"views/pages/floors.html",authenticate:!0}).state("app.departments",{url:"/departments",controller:"DepartmentsCtrl",templateUrl:"views/pages/departments.html",authenticate:!0}).state("app.geofences",{url:"/geofences",controller:"GeofencesCtrl",templateUrl:"views/pages/geofences.html",authenticate:!0}).state("app.inputs",{url:"/inputs",controller:"InputsCtrl",templateUrl:"views/pages/inputs.html",authenticate:!0}).state("app.import-inputs",{url:"/import-inputs",controller:"ImportInputsCtrl",templateUrl:"views/pages/import-inputs.html",authenticate:!0}).state("app.outputs",{url:"/outputs",controller:"OutputsCtrl",templateUrl:"views/pages/outputs.html",authenticate:!0}).state("app.actions",{url:"/actions",templateUrl:"views/pages/actions.html",authenticate:!0}).state("app.debug",{url:"/debug",controller:"DebugCtrl",templateUrl:"views/pages/debug.html",authenticate:!0}).state("app.applications",{url:"/applications",controller:"ApplicationsCtrl",templateUrl:"views/pages/applications.html",authenticate:!0}).state("app.analytics",{url:"/analytics/:id",controller:"AnalyticsCtrl",templateUrl:"views/pages/analytics.html",authenticate:!0}).state("app.reports",{url:"/reports",controller:"ReportsCtrl",templateUrl:"views/pages/reports.html",authenticate:!0}).state("app.account",{url:"/account",controller:"AccountCtrl",templateUrl:"views/pages/account.html",authenticate:!0}).state("core",{"abstract":!0,url:"/core",template:"<div ui-view></div>",containerClass:"core"}).state("core.login",{url:"/login",controller:"LoginCtrl",templateUrl:"views/pages/login.html",containerClass:"core"}).state("core.signup",{url:"/signup",controller:"RegisterCtrl",templateUrl:"views/pages/register.html",containerClass:"core"}).state("core.forgotpass",{url:"/forgotpass",controller:"ForgotPassCtrl",templateUrl:"views/pages/forgotpass.html",containerClass:"core"})}]),app.constant("APIURL","https://api.proximi.fi").constant("FBURL","https://proximiio-event-bus.firebaseio.com/").constant("loginRedirectPath","core.login").controller("MainCtrl",["$scope","$state","AuthService","$localStorage","toastr","toastrConfig",function($scope,$state,AuthService,$localStorage,toastr,toastrConfig){$scope.main={title:"Proximi",appName:"proximiioApp",settings:{headerFixed:!0,asideFixed:!0}},$scope.$storage=$localStorage,$scope.plansNotify={show:!0},$scope.$storage.plansNotify||($scope.$storage.plansNotify=$scope.plansNotify),$scope.logout=function(){AuthService.logout().then(function(){$state.go("core.login",{},{reload:!0})})},AuthService.getCurrentUser().$promise.then(function(res){$scope.getSnippet=function(target){var content;content="curl -X GET \\ \n--header 'Content-Type: application/json' \\ \n--header 'Accept: application/json' \\ \n--header 'Authorization: Bearer "+Object.keys(res.tokens[0])+"' \\ \n'https://api.proximi.fi/core/"+target+"'",alertify.alert("<pre>"+content+"</pre>").set({transition:"zoom"}).set("title","Get CURL snippet!").set("onok",function(closeEvent){console.log("close")})},($scope.$storage.plansNotify.show||$scope.$storage.plansNotify.valid_until<parseInt(moment().format("x")))&&toastr.info('Need better data retention, more features or support? Check out the <a href="/#/app/account" class="text-strong">paid plans</a>.',"Ahoy!",{toastClass:"toast toast-center",timeOut:0,extendedTimeOut:0,allowHtml:!0,closeButton:!0,tapToDismiss:!1,onHidden:function(){$scope.plansNotify={show:!1,dismissed_at:parseInt(moment().format("x")),valid_until:parseInt(moment().add(7,"days").format("x"))},$scope.$storage.plansNotify=$scope.plansNotify}})})}]),app.factory("httpRequestInterceptor",function(){return{request:function(config){return config}}}).config(["$httpProvider",function($httpProvider){$httpProvider.interceptors.push("httpRequestInterceptor"),$httpProvider.interceptors.push(["$q","$location","LoopBackAuth",function($q,$location,LoopBackAuth){return{responseError:function(rejection){return 401===rejection.status&&(LoopBackAuth.clearUser(),LoopBackAuth.clearStorage(),$location.nextAfterLogin=$location.path(),$location.path("/core/login")),$q.reject(rejection)}}}])}]).run(["$rootScope","$state","$stateParams","AuthService","$http",function($rootScope,$state,$stateParams,AuthService,$http){$rootScope.$state=$state,$rootScope.$stateParams=$stateParams,$rootScope.$on("$stateChangeStart",function(event,next){AuthService.isAuthenticated()&&($rootScope.currentUser=AuthService.getCurrentUser()),next.authenticate&&!$rootScope.currentUser&&($rootScope.currentUser=null,event.preventDefault(),$state.go("core.login",{},{reload:!0}))}),$rootScope.$on("$stateChangeSuccess",function(event,toState){event.targetScope.$watch("$viewContentLoaded",function(){angular.element("html, body, #content").animate({scrollTop:0},200),setTimeout(function(){angular.element("#wrap").css("visibility","visible"),angular.element(".dropdown").hasClass("open")||angular.element(".dropdown").find(">ul").slideUp()},200)}),$rootScope.containerClass=toState.containerClass})}]),app.controller("NavCtrl",["$scope",function($scope){$scope.oneAtATime=!1,$scope.status={isFirstOpen:!0,isSecondOpen:!0,isThirdOpen:!0}}]),app.controller("HeaderCtrl",["$scope",function($scope){}]),app.controller("DashboardCtrl",["$scope","$filter","ngTableParams","compressArray","$timeout","Place","Input","Floor","Department","FBURL","$firebaseArray",function($scope,$filter,ngTableParams,compressArray,$timeout,Place,Input,Floor,Department,FBURL,$firebaseArray){$scope.page={title:"Dashboard",subtitle:"Overview for all the places and events"},$scope.placesCount=Place.count(),$scope.inputsCount=Input.count(),$scope.floorsCount=Floor.count(),$scope.departmentsCount=Department.count();var organization,ref=new Firebase(FBURL);$scope.currentUser.$promise.then(function(){console.log("assign from scope:",$scope.currentUser,$scope.currentUser.organization_id),organization=$scope.currentUser.organization_id,$scope.events=$firebaseArray(ref.child("organizations").child(organization).child("proximity")),$scope.events.$loaded().then(function(){function countSameByPlace(){$scope.countEventsByPlace=[];for(var k in $scope.events){var d=$scope.events[k];d.data&&$scope.countEventsByPlace.push(d.data.place)}}countSameByPlace(),$scope.donutData=[],angular.forEach(compressArray($scope.countEventsByPlace),function(key){key.label&&$scope.donutData.push({label:key.label,value:key.data})}),$scope.eventsData=$scope.events.slice(Math.max($scope.events.length-50,0)),$scope.$watchCollection("events",function(){$scope.eventsData=$scope.events.slice(Math.max($scope.events.length-50,0)),countSameByPlace(),$scope.tableParams.reload()}),$scope.tableParams=new ngTableParams({page:1,count:10,sorting:{createdAt:"desc"}},{total:$scope.eventsData.length,getData:function($defer,params){var orderedData=params.sorting()?$filter("orderBy")($scope.eventsData,params.orderBy()):$scope.eventsData;params.total(orderedData.length),$defer.resolve(orderedData.slice((params.page()-1)*params.count(),params.page()*params.count()))}})})})}]),app.controller("LoginCtrl",["$scope","$state","AuthService","$location",function($scope,$state,AuthService,$location){AuthService.isAuthenticated()&&$state.go("app.dashboard",{},{reload:!0}),$scope.login=function(){AuthService.login($scope.credentials).then(function(){$state.go("app.dashboard",{},{reload:!0})})}}]).controller("RegisterCtrl",["$scope","$state","AuthService","$location",function($scope,$state,AuthService,$location){AuthService.isAuthenticated()&&$state.go("app.dashboard",{},{reload:!0}),$scope.register=function(){AuthService.register($scope.credentials).then(function(){$state.go("app.dashboard",{},{reload:!0})})},$scope.backgrounds=["Freelance developer","Developer in a software development company","In-house developer","Researcher","I do marketing","I do sales","Other"]}]).controller("ForgotPassCtrl",["$scope","$state","AuthService","$location",function($scope,$state,AuthService,$location){AuthService.isAuthenticated()&&$state.go("app.dashboard",{},{reload:!0})}]),app.controller("OperationRequestCtrl",["$scope","toastr",function($scope,toastr){$scope.request=function(type){$scope.currentUser&&"orchestrator"===type&&alertify.confirm('Proximi.io Orchestrator is available during the beta for free. We will setup an instance for you in the IMB Bluemix Cloud after you\'ve sent us the request. After the beta we will enable the self service model and you can fire up your own instance of the Orchestrator from the portal (Driver plan required after beta, see <a href="http://proximi.io/pricing/" target="_blank">http://proximi.io/pricing</a>).<br/><br/>More details about the Proximi.io Orchestrator: <a href="http://proximi.io/external-actions-integrations/" target="_blank">http://proximi.io/external-actions-integrations</a>').set({transition:"zoom"}).set("title","Request Orchestrator access").set("labels",{ok:"Send Request!"}).set("onok",function(closeEvent){}).set("oncancel",function(closeEvent){console.log("Cancel")}),$scope.currentUser&&"reports"===type&&alertify.confirm('Proximi.io Reports is available during the beta for free. We will setup an instance for you in the IMB Bluemix Cloud after you\'ve sent us the request. After the beta we will enable the self service model and you can fire up your own instance of the Reports tool from the portal (Driver plan required after beta, see <a href="http://proximi.io/pricing/" target="_blank">http://proximi.io/pricing/</a>).').set({transition:"zoom"}).set("title","Request Reports access").set("labels",{ok:"Send Request!"}).set("onok",function(closeEvent){}).set("oncancel",function(closeEvent){console.log("Cancel")})}}]),app.controller("DemoBuilderCtrl",["$scope","toastr","$modal","$log","User","Place","Floor","Department","Input","Output","EventsService",function($scope,toastr,$modal,$log,User,Place,Floor,Department,Input,Output,EventsService){var auth=!1;User.isAuthenticated()&&($scope.user=User.getCurrent(),$scope.user&&(auth||(auth=!0))),$scope.builder={},$scope.builderModal=function(){var modalInstance=$modal.open({templateUrl:"views/pages/builder-modal.html",controller:"BuilderModalCtrl",scope:$scope});modalInstance.result.then(function(builder){builder.organization_id=$scope.user.organization.id;var place={organization_id:builder.organization_id,name:"Demo place",address:builder.address,location:{lat:builder.lat,lng:builder.lng},tags:["Demo place tag"]},floor={organization_id:builder.organization_id,name:"Demo floor",anchors:[{lat:builder.lat,lng:builder.lng},{lat:builder.lat,lng:builder.lng-.001},{lat:builder.lat-.001,lng:builder.lng-.001},{lat:builder.lat-.001,lng:builder.lng}]},department={organization_id:builder.organization_id,name:"Demo department",tags:["Demo place tag"]},input={organization_id:builder.organization_id,name:"Demo input",type:"GPS Geofence",data:{circle:{lat:builder.lat,lng:builder.lng},map:{lat:builder.lat,lng:builder.lng,zoom:18},radius:30}};({organization_id:builder.organization_id,name:"Demo output",type:"Push Messages",title:"Output title",content:"Output content"});Place.create(place,function(placeRef){floor.place_id=placeRef.id,Floor.create(floor,function(floorRef){department.place_id=placeRef.id,department.floor_id=floorRef.id,Department.create(department,function(departmentRef){input.department_id=departmentRef.id,Input.create(input,function(inputRef){toastr.success("Wizard created all required data for you","Wizard finished!")})})})})},function(data){data&&"disableBuilder"===data&&($scope.user.disableBuilder=!0),$log.info("Modal dismissed at: "+new Date)})},!$scope.user.disableBuilder}]).controller("BuilderModalCtrl",["$scope","$modalInstance","Geocoder",function($scope,$modalInstance,Geocoder){$scope.geoCodeAddress=function(){Geocoder.geocodeAddress($scope.builder.address).then(function(result){$scope.builder.lat=result.lat,$scope.builder.lng=result.lng})},$scope.ok=function(){$modalInstance.close($scope.builder)},$scope.cancel=function(data){$modalInstance.dismiss(data)}}]),app.controller("PlacesCtrl",["$scope","$modal","$log","$filter","ngTableParams","toastr","Place","EventsService",function($scope,$modal,$log,$filter,ngTableParams,toastr,Place,EventsService){function getList(){Place.find({},function(list){$scope.places=list},function(errorResponse){console.log(errorResponse)})}$scope.page={title:"Manage Places",subtitle:"subtitle goes here"},$scope.places=[],getList(),$scope.openModal=function(place){$scope.editPlace=!1,place?($scope.place=place,$scope.editPlace=!0,$scope.place.tags||($scope.place.tags=[])):$scope.place={name:"",address:"",location:{lat:"",lng:"",zoom:10},tags:[]};var modalInstance=$modal.open({templateUrl:"placeControlModal.html",controller:"PlacesModalCtrl",resolve:{place:function(){return $scope.place},editPlace:function(){return $scope.editPlace}}});modalInstance.result.then(function(place){var runOperation=function(){$scope.place={name:"",address:"",location:{lat:"",lng:""},tags:[]}};Place.upsert(place,function(res){$scope.editPlace===!1?toastr.success("New place has been created","Place Created!"):toastr.success("Place changes has been saved","Place Updated!"),runOperation(),getList()},function(res){console.log(res)})},function(){getList(),$log.info("Modal dismissed at: "+new Date)})},$scope.showPlace=function(place){$scope.place=place,$modal.open({templateUrl:"placeViewModal.html",controller:"ShowPlaceModalCtrl",resolve:{place:function(){return $scope.place}}})},$scope.deletePlace=function(place){alertify.confirm("Are you sure you want to delete this place?").set({transition:"zoom"}).set("title","Alert!").set("onok",function(closeEvent){Place.deleteById({id:place.id},function(res){getList(),toastr.success("Place has been removed","Place Removed!")},function(res){console.log(res)})}).set("oncancel",function(closeEvent){console.log("Cancel")})},$scope.$watchCollection("places",function(){$scope.tableParams.reload()}),$scope.tableParams=new ngTableParams({page:1,count:10,sorting:{name:"asc"}},{total:$scope.places.length,getData:function($defer,params){var orderedData=params.sorting()?$filter("orderBy")($scope.places,params.orderBy()):$scope.places;params.total(orderedData.length),$defer.resolve(orderedData.slice((params.page()-1)*params.count(),params.page()*params.count()))}})}]).controller("PlacesModalCtrl",["$scope","$modalInstance","place","editPlace","leafletData","Geocoder",function($scope,$modalInstance,place,editPlace,leafletData,Geocoder){$scope.place=place,$scope.editPlace=editPlace,$scope.geoCodeAddress=function(){Geocoder.geocodeAddress($scope.place.address).then(function(result){$scope.place.location.lat=result.lat,$scope.place.location.lng=result.lng})},$scope.ok=function(){$modalInstance.close($scope.place)},$scope.cancel=function(){$modalInstance.dismiss("cancel")}}]).controller("ShowPlaceModalCtrl",["$scope","$modalInstance","place",function($scope,$modalInstance,place){$scope.place=place,$scope.cancel=function(){$modalInstance.dismiss("cancel")}}]),app.controller("FloorsCtrl",["$scope","$modal","$log","$filter","ngTableParams","toastr","Place","Floor","EventsService",function($scope,$modal,$log,$filter,ngTableParams,toastr,Place,Floor,EventsService){function getList(){Floor.find({},function(list){$scope.floors=list},function(errorResponse){console.log(errorResponse)})}$scope.page={title:"Manage Floors",subtitle:"subtitle goes here"},$scope.places=Place.find(),$scope.floors=[],getList(),$scope.openModal=function(floor){$scope.editing=!1,floor?($scope.floor=floor,$scope.editing=!0):$scope.floor={name:null,place_id:null,floorplan_image_url:null,indooratlas_floor_id:null,indooratlas_floorplan_id:null};var modalInstance=$modal.open({templateUrl:"floorCrudModal.html",controller:"FloorsCrudModalCtrl",resolve:{floor:function(){return $scope.floor},places:function(){return $scope.places},editing:function(){return $scope.editing}}});modalInstance.result.then(function(floor){var runOperation=function(){$scope.floor={name:null,place_id:null,floorplan_image_url:null,indooratlas_floor_id:null,indooratlas_floorplan_id:null}};Floor.upsert(floor,function(res){$scope.editing===!1?toastr.success("New floor has been created","Floor Created!"):toastr.success("Floor changes has been saved","Floor Updated!"),runOperation(),getList()},function(res){console.log(res)})},function(){getList(),$log.info("Modal dismissed at: "+new Date)})},$scope.show=function(floor){$scope.floor=floor,$modal.open({templateUrl:"floorViewModal.html",controller:"ShowFloorModalCtrl",resolve:{floor:function(){return $scope.floor},places:function(){return $scope.places}}})},$scope["delete"]=function(floor){alertify.confirm("Are you sure you want to delete this floor?").set({transition:"zoom"}).set("title","Alert!").set("onok",function(closeEvent){Floor.deleteById({id:floor.id},function(res){console.log(res),getList(),toastr.success("Floor has been removed","Floor Removed!")},function(res){console.log(res)})}).set("oncancel",function(closeEvent){console.log("Cancel")})},$scope.$watchCollection("floors",function(){$scope.tableParams.reload()}),$scope.tableParams=new ngTableParams({page:1,count:10,sorting:{name:"asc"}},{total:$scope.floors.length,getData:function($defer,params){var orderedData=params.sorting()?$filter("orderBy")($scope.floors,params.orderBy()):$scope.floors;params.total(orderedData.length),$defer.resolve(orderedData.slice((params.page()-1)*params.count(),params.page()*params.count()))}})}]).controller("FloorsCrudModalCtrl",["$scope","$modalInstance","floor","editing","leafletData","Geocoder","places","$filter",function($scope,$modalInstance,floor,editing,leafletData,Geocoder,places,$filter){$scope.floor=floor,$scope.editing=editing,$scope.places=places,$scope.placeSelect=function(){var floorPlace=$scope.floor.place_id;$scope.place=$filter("filter")(places,{id:floorPlace})[0],$scope.center={lat:$scope.place.location.lat,lng:$scope.place.location.lng,zoom:18}},$scope.center={lat:null,lng:null,zoom:null},angular.extend($scope,{defaults:{maxZoom:22}}),angular.extend($scope,{layers:{baselayers:{osm:{name:"OpenStreetMap",type:"xyz",url:"http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",layerOptions:{attribution:'&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',continuousWorld:!0,maxZoom:22,maxNativeZoom:18}}}}});var initializeFloorplan=function(map){$scope.floor.anchors?$scope.floor.anchors=floor.anchors:$scope.floor.anchors=[{lat:$scope.place.location.lat,lng:$scope.place.location.lng},{lat:$scope.place.location.lat,lng:$scope.place.location.lng-.001},{lat:$scope.place.location.lat-.001,lng:$scope.place.location.lng-.001},{lat:$scope.place.location.lat-.001,lng:$scope.place.location.lng}];var image=L.imageTransform($scope.floor.floorplan_image_url,$scope.floor.anchors,{opacity:.7}).addTo(map),externalPolygon=L.polygon($scope.floor.anchors,{fill:!1}).addTo(map),updateAnchors=function(){$scope.floor.anchors=anchorMarkers.map(function(marker){return marker.getLatLng()}),image.setAnchors($scope.floor.anchors),externalPolygon.setLatLngs($scope.floor.anchors)},anchorMarkers=$scope.floor.anchors.map(function(anchor){return L.marker(anchor,{draggable:!0}).addTo(map).on("drag",updateAnchors)})};$scope.loadMap=function(){floor.anchors&&($scope.center={lat:floor.anchors[0].lat,lng:floor.anchors[0].lng,zoom:18}),leafletData.getMap().then(function(map){setTimeout(function(){map.invalidateSize(),initializeFloorplan(map)},500)})},$scope.ok=function(){$modalInstance.close($scope.floor)},$scope.cancel=function(){$modalInstance.dismiss("cancel")}}]).controller("ShowFloorModalCtrl",["$scope","$modalInstance","floor","places",function($scope,$modalInstance,floor,places){$scope.floor=floor,$scope.places=places,$scope.cancel=function(){$modalInstance.dismiss("cancel")}}]),app.controller("DepartmentsCtrl",["$scope","$modal","$log","$filter","ngTableParams","toastr","Place","Floor","Department","EventsService",function($scope,$modal,$log,$filter,ngTableParams,toastr,Place,Floor,Department,EventsService){function getList(){Department.find({},function(list){$scope.departments=list},function(errorResponse){console.log(errorResponse)})}$scope.page={title:"Manage Departments",subtitle:"subtitle goes here"},$scope.places=Place.find(),$scope.floors=Floor.find(),$scope.departments=[],getList(),$scope.openModal=function(department){$scope.editDepartment=!1,department?($scope.department=department,$scope.editDepartment=!0,$scope.department.tags||($scope.department.tags=[])):$scope.department={place_id:"",name:"",tags:[]};var modalInstance=$modal.open({templateUrl:"departmentControlModal.html",controller:"DepartmentsModalCtrl",resolve:{department:function(){return $scope.department},departments:function(){return $scope.departments},places:function(){return $scope.places},floors:function(){return $scope.floors},editDepartment:function(){return $scope.editDepartment}}});modalInstance.result.then(function(department){var runOperation=function(departmentRef){$scope.department={place_id:"",name:"",tags:[]}};Department.upsert(department,function(res){$scope.editDepartment===!1?toastr.success("New department has been created","Department Created!"):toastr.success("Department changes has been saved","Department Updated!"),runOperation(),getList()},function(res){console.log(res)})},function(){getList(),$log.info("Modal dismissed at: "+new Date)})},$scope.showDepartment=function(department){$scope.department=department,$modal.open({templateUrl:"departmentViewModal.html",controller:"ShowDepartmentModalCtrl",resolve:{department:function(){return $scope.department},places:function(){return $scope.places},floors:function(){return $scope.floors}}})},$scope.deleteDepartment=function(department){alertify.confirm("Are you sure you want to delete this department?").set({transition:"zoom"}).set("title","Alert!").set("onok",function(closeEvent){Department.deleteById({id:department.id},function(res){console.log(res),getList(),toastr.success("Department has been removed","Department Removed!")},function(res){console.log(res)})}).set("oncancel",function(closeEvent){console.log("Cancel")})},$scope.$watchCollection("departments",function(){$scope.tableParams.reload()}),$scope.tableParams=new ngTableParams({page:1,count:10,sorting:{name:"asc"}},{total:$scope.departments.length,getData:function($defer,params){var orderedData=params.sorting()?$filter("orderBy")($scope.departments,params.orderBy()):$scope.departments;params.total(orderedData.length),$defer.resolve(orderedData.slice((params.page()-1)*params.count(),params.page()*params.count()))}})}]).controller("DepartmentsModalCtrl",["$scope","$modalInstance","places","department","editDepartment","leafletData","floors","departments","$filter",function($scope,$modalInstance,places,department,editDepartment,leafletData,floors,departments,$filter){$scope.places=places,$scope.department=department,$scope.editDepartment=editDepartment,$scope.floors=floors,$scope.placeSelected=!1,$scope.placeSelect=function(){$scope.placeSelected=!0;var departmentPlace=$scope.department.place_id;$scope.floors=$filter("filter")(floors,{place_id:departmentPlace})},$scope.floorSelect=function(){var departmentFloor=$scope.department.floor_id;$scope.floor=$filter("filter")(floors,{id:departmentFloor})[0]},editDepartment&&($scope.placeSelect(),$scope.floorSelect()),$scope.ok=function(){$modalInstance.close($scope.department)},$scope.cancel=function(){$modalInstance.dismiss("cancel")}}]).controller("ShowDepartmentModalCtrl",["$scope","$modalInstance","department","places","floors",function($scope,$modalInstance,department,places,floors){$scope.department=department,$scope.places=places,$scope.cancel=function(){$modalInstance.dismiss("cancel")}}]),app.controller("InputsCtrl",["$scope","$modal","$log","$filter","ngTableParams","toastr","Input","Department","Place","Floor","EventsService",function($scope,$modal,$log,$filter,ngTableParams,toastr,Input,Department,Place,Floor,EventsService){function getList(){Input.find({},function(list){$scope.inputs=list},function(errorResponse){console.log(errorResponse)})}$scope.page={title:"Manage Inputs",subtitle:"subtitle goes here"},$scope.places=Place.find(),$scope.floors=Floor.find(),$scope.departments=Department.find(),$scope.inputs=[],getList(),$scope.openModal=function(input){$scope.editInput=!1,input?($scope.input=input,$scope.editInput=!0):$scope.input={name:"",type:"",data:{marker:{},major:"",minor:"",uuid:""}};var modalInstance=$modal.open({templateUrl:"inputControlModal.html",controller:"InputsModalCtrl",resolve:{input:function(){return $scope.input},editInput:function(){return $scope.editInput},departments:function(){return $scope.departments},places:function(){return $scope.places},floors:function(){return $scope.floors}}});modalInstance.result.then(function(input){var runOperation=function(){$scope.input={name:"",type:"",data:{marker:{},major:"",minor:"",uuid:""}}};if("iBeacon"===input.type){var iBeaconInput={id:input.id||null,name:input.name,type:input.type,department_id:input.department_id,data:{major:input.data.major,minor:input.data.minor,uuid:input.data.uuid,marker:{lat:input.data.marker.lat,lng:input.data.marker.lng}},triggerFloorChange:input.triggerFloorChange||null,floor_id:input.floor_id||null,triggerVenueChange:input.triggerVenueChange||null,place_id:input.place_id||null,createdAt:null,updatedAt:null};Input.upsert(iBeaconInput,function(res){console.log(res),$scope.editInput===!1?toastr.success("New input has been created","Input Created!"):toastr.success("Input changes has been saved","Input Updated!"),runOperation(),getList()},function(res){console.log(res)})}if("Eddystone Beacon"===input.type){var eddystoneInput={id:input.id||null,name:input.name,type:input.type,department_id:input.department_id,data:{namespaceid:input.data.namespaceid,instanceid:input.data.instanceid,marker:{lat:input.data.marker.lat,lng:input.data.marker.lng}},triggerFloorChange:input.triggerFloorChange||null,floor_id:input.floor_id||null,triggerVenueChange:input.triggerVenueChange||null,place_id:input.place_id||null,createdAt:null,updatedAt:null};Input.upsert(eddystoneInput,function(res){$scope.editInput===!1?toastr.success("New input has been created","Input Created!"):toastr.success("Input changes has been saved","Input Updated!"),runOperation(),getList()},function(res){console.log(res)})}if("Custom"===input.type){var customInput={id:input.id||null,name:input.name,type:input.type,department_id:input.department_id,data:{marker:{lat:input.data.marker.lat,lng:input.data.marker.lng}},createdAt:null,updatedAt:null};Input.upsert(customInput,function(res){$scope.editInput===!1?toastr.success("New input has been created","Input Created!"):toastr.success("Input changes has been saved","Input Updated!"),runOperation(),getList()},function(res){console.log(res)})}},function(){getList(),$log.info("Modal dismissed at: "+new Date)})},$scope.showInput=function(input){$scope.input=input,$modal.open({templateUrl:"inputViewModal.html",controller:"ShowInputModalCtrl",resolve:{input:function(){return $scope.input}}})},$scope.deleteInput=function(input){alertify.confirm("Are you sure you want to delete this input?").set({transition:"zoom"}).set("title","Alert!").set("onok",function(closeEvent){Input.deleteById({id:input.id},function(res){console.log(res),getList(),toastr.success("Input has been removed","Input Removed!")},function(res){console.log(res)})}).set("oncancel",function(closeEvent){console.log("Cancel")})},$scope.$watchCollection("inputs",function(){$scope.tableParams.reload()}),$scope.tableParams=new ngTableParams({page:1,count:10,sorting:{name:"asc"}},{total:$scope.inputs.length,getData:function($defer,params){var orderedData=params.sorting()?$filter("orderBy")($scope.inputs,params.orderBy()):$scope.inputs;params.total($scope.inputs.length),$defer.resolve(orderedData.slice((params.page()-1)*params.count(),params.page()*params.count()))}})}]).controller("InputsModalCtrl",["$scope","$modalInstance","input","editInput","leafletData","departments","places","floors","$filter",function($scope,$modalInstance,input,editInput,leafletData,departments,places,floors,$filter){$scope.input=input,$scope.editInput=editInput,$scope.departments=departments,$scope.floors=floors,$scope.places=places,$scope.inputTypes={iBeacon:"iBeacon",eddystone:"Eddystone Beacon",custom:"Custom"},$scope.departmentSelect=function(){var lat,lng,department_id=$scope.input.department_id;$scope.department=$filter("filter")(departments,{id:department_id})[0],$scope.place=$filter("filter")(places,{id:$scope.department.place_id})[0],input.department_id&&$scope.place?(lat=$scope.place.location.lat,lng=$scope.place.location.lng,input.data.marker.lat=lat,input.data.marker.lng=lng):(input.data.marker.lat=0,input.data.marker.lng=0)},editInput&&input.department_id&&($scope.department=$filter("filter")(departments,{id:input.department_id})[0]),angular.extend($scope,{defaults:{maxZoom:22}}),angular.extend($scope,{layers:{baselayers:{osm:{name:"OpenStreetMap",type:"xyz",url:"http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",layerOptions:{subdomains:["a","b","c"],attribution:'&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',continuousWorld:!0,maxZoom:22,maxNativeZoom:18}}}}}),$scope.location={lat:0,lng:0,zoom:18};var mapLoaded=!1;$scope.loadMap=function(){mapLoaded||(mapLoaded=!0,$scope.location.lat=$scope.input.data.marker.lat,$scope.location.lng=$scope.input.data.marker.lng,$scope.place_id=$scope.department.place_id,$scope.floor_id=$scope.department.floor_id,$scope.floor=$filter("filter")(floors,{id:$scope.floor_id})[0],$scope.anchors=$scope.floor.anchors,$scope.url=$scope.floor.floorplan_image_url,leafletData.getMap().then(function(map){setTimeout(function(){var image=L.imageTransform($scope.url,$scope.anchors,{opacity:.7});map.addLayer(image),angular.extend($scope,{markers:{}}),("iBeacon"===input.type||"Eddystone Beacon"===input.type||"Custom"===input.type)&&($scope.markers={m1:{focus:!0,draggable:!0,lat:input.data.marker.lat,lng:input.data.marker.lng,icon:{type:"div",className:"beacon-map-marker",iconSize:200,iconAnchor:[100,123],html:'<div contenteditable="true">'+input.name+"</div>"}}},$scope.$on("leafletDirectiveMarker.dragend",function(event,args){input.data.marker.lat=args.model.lat,input.data.marker.lng=args.model.lng})),"Custom"===input.type&&($scope.markers.m1.icon.className="custom-map-marker"),map.invalidateSize(),L.control.layers({},{"Floor Plan":image}).addTo(map)},3e3)}))},$scope.ok=function(){$modalInstance.close($scope.input)},$scope.cancel=function(){$modalInstance.dismiss("cancel")}}]).controller("ShowInputModalCtrl",["$scope","$modalInstance","input",function($scope,$modalInstance,input){$scope.input=input,$scope.cancel=function(){$modalInstance.dismiss("cancel")}}]),app.controller("ImportInputsCtrl",["$scope","$modal","$log","$http","$filter","ngTableParams","toastr","Input","Department","Place","Floor","EventsService",function($scope,$modal,$log,$http,$filter,ngTableParams,toastr,Input,Department,Place,Floor,EventsService){function initKontaktIOTable(){$scope.kontaktio.table=new ngTableParams({page:1,count:10,
sorting:{uniqueId:"asc"}},{total:$scope.kontaktio.devices.length,getData:function($defer,params){var orderedData=params.sorting()?$filter("orderBy")($scope.kontaktio.devices,params.orderBy()):$scope.kontaktio.devices;params.total(orderedData.length),$defer.resolve(orderedData.slice((params.page()-1)*params.count(),params.page()*params.count()))}})}function initEstimoteTable(){$scope.estimote.table=new ngTableParams({page:1,count:10,sorting:{uniqueId:"asc"}},{total:$scope.estimote.devices.length,getData:function($defer,params){var orderedData=params.sorting()?$filter("orderBy")($scope.estimote.devices,params.orderBy()):$scope.estimote.devices;params.total(orderedData.length),$defer.resolve(orderedData.slice((params.page()-1)*params.count(),params.page()*params.count()))}})}$scope.page={title:"Import Inputs",subtitle:"subtitle goes here"},$scope.places=Place.find(),$scope.floors=Floor.find(),$scope.departments=Department.find(),$scope.inputs=Input.find(),$scope.kontaktio={connect:!1},$scope.estimote={connect:!1},$scope.kontaktIOReq={method:"GET",url:"https://api.kontakt.io/device",headers:{"Api-Key":null,Accept:"application/vnd.com.kontakt+json; version=7"}},$scope.estimoteReq={method:"GET",url:"https://api.kontakt.io/device",headers:{"Api-Key":null,Accept:"application/vnd.com.kontakt+json; version=7"}};var getKontaktIO=function(){$scope.kontaktio.devices=[],$http($scope.kontaktIOReq).then(function(response){angular.forEach(response.data.devices,function(value,key){"CLOUD_BEACON"!==value.deviceType&&$scope.kontaktio.devices.push(value)}),$scope.kontaktio.connect=!0,initKontaktIOTable(),console.log($scope.kontaktio.devices)},function(response){console.log(response)})},getEstimote=function(){$scope.estimote.devices=[],$http($scope.estimoteReq).then(function(response){angular.forEach(response.data.devices,function(value,key){"CLOUD_BEACON"!==value.deviceType&&$scope.estimote.devices.push(value)}),$scope.estimote.connect=!0,initEstimoteTable(),console.log($scope.estimote.devices)},function(response){console.log(response)})};$scope.connect=function(source){"kontaktIO"===source&&($scope.kontaktIOReq.headers["Api-Key"]=$scope.kontaktio.apiKey,getKontaktIO()),"estimote"===source&&($scope.estimoteReq.headers["Api-Key"]=$scope.estimote.apiKey,getEstimote())},$scope.refresh=function(source){"kontaktIO"===source&&getKontaktIO(),"estimote"===source&&getEstimote()},$scope.openModal=function(input){$scope.input=input;var modalInstance=$modal.open({templateUrl:"inputControlModal.html",controller:"ImportInputsModalCtrl",resolve:{input:function(){return $scope.input},departments:function(){return $scope.departments},places:function(){return $scope.places},floors:function(){return $scope.floors}}});modalInstance.result.then(function(input){console.log(input),input.organization_id=$scope.currentUser.organization.id,Input.create(input,function(res){console.log(res),toastr.success("New input has been created","Input Created!")},function(res){console.log(res)})},function(){$log.info("Modal dismissed at: "+new Date)})}}]).controller("ImportInputsModalCtrl",["$scope","$modalInstance","input","leafletData","departments","places","floors","$filter",function($scope,$modalInstance,input,leafletData,departments,places,floors,$filter){input.marker={},$scope.input={data:input},$scope.departments=departments,$scope.floors=floors,$scope.places=places,$scope.input.name=input.uniqueId,"EDDYSTONE"===input.profiles[0]&&($scope.input.type="Eddystone Beacon",$scope.input.data.namespaceid=input.namespace,$scope.input.data.instanceid=input.instanceId),"IBEACON"===input.profiles[0]&&($scope.input.type="iBeacon",$scope.input.data.uuid=input.proximity),$scope.departmentSelect=function(){var lat,lng,department_id=$scope.input.department_id;$scope.department=$filter("filter")(departments,{id:department_id})[0],$scope.place=$filter("filter")(places,{id:$scope.department.place_id})[0],$scope.department.anchors?(lat=$scope.department.anchors[0].lat,lng=$scope.department.anchors[0].lng,$scope.input.data.marker.lat=lat,$scope.input.data.marker.lng=lng):(lat=$scope.place.location.lat,lng=$scope.place.location.lng,$scope.input.data.marker.lat=lat,$scope.input.data.marker.lng=lng)},$scope.location={lat:0,lng:0,zoom:18},angular.extend($scope,{defaults:{maxZoom:22}}),angular.extend($scope,{layers:{baselayers:{osm:{name:"OpenStreetMap",type:"xyz",url:"http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",layerOptions:{subdomains:["a","b","c"],attribution:'&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',continuousWorld:!0,maxZoom:22,maxNativeZoom:18}}}}});var mapLoaded=!1;$scope.loadMap=function(){mapLoaded||(mapLoaded=!0,$scope.location.lat=$scope.input.data.marker.lat,$scope.location.lng=$scope.input.data.marker.lng,console.log($scope.input),$scope.polygon=$scope.department.anchors,$scope.place_id=$scope.department.place_id,$scope.floor_id=$scope.department.floor_id,$scope.floor=$filter("filter")(floors,{id:$scope.floor_id})[0],$scope.anchors=$scope.floor.anchors,$scope.url=$scope.floor.floorplan_image_url,leafletData.getMap().then(function(map){setTimeout(function(){if($scope.polygon){L.polygon($scope.polygon).addTo(map)}var image=L.imageTransform($scope.url,$scope.anchors,{opacity:.7});map.addLayer(image),angular.extend($scope,{markers:{}}),("iBeacon"===$scope.input.type||"Eddystone Beacon"===$scope.input.type)&&($scope.markers={m1:{focus:!0,draggable:!0,lat:$scope.input.data.marker.lat,lng:$scope.input.data.marker.lng,icon:{type:"div",className:"beacon-map-marker",iconSize:200,iconAnchor:[100,123],html:'<div contenteditable="true">'+$scope.input.name+"</div>"}}},$scope.$on("leafletDirectiveMarker.dragend",function(event,args){$scope.input.data.marker.lat=args.model.lat,$scope.input.data.marker.lng=args.model.lng})),map.invalidateSize(),L.control.layers({},{"Floor Plan":image}).addTo(map)},500)}))},$scope.ok=function(){$modalInstance.close($scope.input)},$scope.cancel=function(){$modalInstance.dismiss("cancel")}}]),app.controller("OutputsCtrl",["$scope","$modal","$log","$filter","ngTableParams","toastr","Output","EventsService",function($scope,$modal,$log,$filter,ngTableParams,toastr,Output,EventsService){function getList(){Output.find({},function(list){$scope.outputs=list},function(errorResponse){console.log(errorResponse)})}$scope.page={title:"Manage Outputs",subtitle:"subtitle goes here"},$scope.outputs=[],getList(),$scope.openModal=function(output){$scope.editOutput=!1,output?($scope.output=output,$scope.editOutput=!0):$scope.output={name:""};var modalInstance=$modal.open({templateUrl:"outputControlModal.html",controller:"OutputsModalCtrl",resolve:{output:function(){return $scope.output},editOutput:function(){return $scope.editOutput}}});modalInstance.result.then(function(output){var pairs=output[1];output=output[0];var runOperation=function(){$scope.output={name:""}};pairs&&pairs.length>0?(output.pairs={},angular.forEach(pairs,function(value,key){"number"===value.type?output.pairs[value.key]=parseFloat(value.value):output.pairs[value.key]=value.value})):delete output.pairs,Output.upsert(output,function(res){$scope.editOutput===!1?toastr.success("New output has been created","Output Created!"):toastr.success("Output changes has been saved","Output Updated!"),runOperation(),getList()},function(res){console.log(res)})},function(){getList(),$log.info("Modal dismissed at: "+new Date)})},$scope.showOutput=function(output){$scope.output=output,$modal.open({templateUrl:"outputViewModal.html",controller:"ShowOutputModalCtrl",resolve:{output:function(){return $scope.output}}})},$scope.deleteOutput=function(output){alertify.confirm("Are you sure you want to delete this output?").set({transition:"zoom"}).set("title","Alert!").set("onok",function(closeEvent){Output.deleteById({id:output.id},function(res){getList(),toastr.success("Output has been removed","Output Removed!")},function(res){console.log(res)})}).set("oncancel",function(closeEvent){console.log("Cancel")})},$scope.$watchCollection("outputs",function(){$scope.tableParams.reload()}),$scope.tableParams=new ngTableParams({page:1,count:10,sorting:{name:"asc"}},{total:$scope.outputs.length,getData:function($defer,params){var orderedData=params.sorting()?$filter("orderBy")($scope.outputs,params.orderBy()):$scope.outputs;params.total($scope.outputs.length),$defer.resolve(orderedData.slice((params.page()-1)*params.count(),params.page()*params.count()))}})}]).controller("OutputsModalCtrl",["$scope","$modalInstance","output","editOutput",function($scope,$modalInstance,output,editOutput){$scope.output=output,$scope.editOutput=editOutput,$scope.inputTypes={number:"Number",text:"String"},$scope.pairs=[],$scope.output.pairs&&angular.forEach($scope.output.pairs,function(value,key){isNaN(value)?$scope.pairs.push({key:key,value:value,type:"text"}):$scope.pairs.push({key:key,value:value,type:"number"})}),$scope.addPair=function(){$scope.pairs.push({key:null,value:null,type:"text"})},$scope.removePair=function(index){$scope.pairs.splice(index,1)},$scope.ok=function(){$modalInstance.close([$scope.output,$scope.pairs])},$scope.cancel=function(){$modalInstance.dismiss("cancel")}}]).controller("ShowOutputModalCtrl",["$scope","$modalInstance","output",function($scope,$modalInstance,output){$scope.output=output,$scope.cancel=function(){$modalInstance.dismiss("cancel")}}]),app.controller("ApiKeysCtrl",["$scope","$modal","$log","$filter","ngTableParams","$http","Application",function($scope,$modal,$log,$filter,ngTableParams,$http,Application){function getList(){Application.find({},function(list){$scope.applications=list},function(errorResponse){console.log(errorResponse)})}$scope.page={title:"Api Keys",subtitle:"subtitle goes here"},$scope.currentUser.$promise.then(function(){var tokenGenURL="https://proximiio-token-generator.herokuapp.com";$scope.authToken="Obtaining the auth-token, please wait...";var payload={organization:$scope.currentUser.organization_id,uid:"user.uid",token:"user.token"};$http.post(tokenGenURL,payload).success(function(data,status,headers,config){$scope.authToken=data}).error(function(data,status,headers,config){})}),$scope.applications=[],getList()}]),app.controller("GeofencesCtrl",["$scope","$modal","$log","$filter","ngTableParams","toastr","Place","Geofence","Department","Floor","EventsService",function($scope,$modal,$log,$filter,ngTableParams,toastr,Place,Geofence,Department,Floor,EventsService){function getList(){Geofence.find({},function(list){$scope.geofences=list},function(errorResponse){console.log(errorResponse)})}$scope.page={title:"Manage Geofences",subtitle:"subtitle goes here"},$scope.places=Place.find(),$scope.departments=Department.find(),$scope.floors=Floor.find(),$scope.geofences=[],getList(),$scope.openModal=function(geofence){$scope.editing=!1,geofence?($scope.geofence=geofence,$scope.editing=!0):$scope.geofence={area:{}};var modalInstance=$modal.open({templateUrl:"geofenceControlModal.html",controller:"GeofenceModalCtrl",resolve:{geofence:function(){return $scope.geofence},places:function(){return $scope.places},departments:function(){return $scope.departments},floors:function(){return $scope.floors},editing:function(){return $scope.editing}}});modalInstance.result.then(function(geofence){var runOperation=function(){$scope.geofence={area:{}}};console.log("should upsert geofence: ",geofence),Geofence.upsert(geofence,function(res){$scope.editing===!1?toastr.success("New geofence has been created","Geofence Created!"):toastr.success("Geofence changes has been saved","Geofence Updated!"),runOperation(),getList()},function(res){console.log(res)})},function(){getList(),$log.info("Modal dismissed at: "+new Date)})},$scope.show=function(geofence){$scope.geofence=geofence,$modal.open({templateUrl:"geofenceViewModal.html",controller:"ShowGeofenceModalCtrl",resolve:{geofence:function(){return $scope.geofence},places:function(){return $scope.places},departments:function(){return $scope.departments}}})},$scope["delete"]=function(geofence){alertify.confirm("Are you sure you want to delete this ge?").set({transition:"zoom"}).set("title","Alert!").set("onok",function(closeEvent){Geofence.deleteById({id:geofence.id},function(res){console.log(res),getList(),toastr.success("Geofence has been removed","Geofence Removed!")},function(res){console.log(res)})}).set("oncancel",function(closeEvent){console.log("Cancel")})},$scope.$watchCollection("geofences",function(){$scope.tableParams.reload()}),$scope.tableParams=new ngTableParams({page:1,count:10,sorting:{name:"asc"}},{total:$scope.geofences.length,getData:function($defer,params){var orderedData=params.sorting()?$filter("orderBy")($scope.geofences,params.orderBy()):$scope.geofences;params.total(orderedData.length),$defer.resolve(orderedData.slice((params.page()-1)*params.count(),params.page()*params.count()))}})}]).controller("GeofenceModalCtrl",["$scope","$modalInstance","geofence","editing","leafletData","Geocoder","places","departments","floors","$filter",function($scope,$modalInstance,geofence,editing,leafletData,Geocoder,places,departments,floors,$filter){$scope.geofence=geofence,$scope.editing=editing,$scope.places=places,$scope.departments=departments,$scope.floors=floors,$scope.geoCodeAddress=function(){Geocoder.geocodeAddress($scope.geofence.address).then(function(result){$scope.geofence.area.lat=result.lat,$scope.geofence.area.lng=result.lng})},geofence.place_id&&($scope.filteredDepartments=$filter("filter")($scope.departments,{place_id:geofence.place_id})),$scope.placeSelect=function(){var geofencePlace=$scope.geofence.place_id,place=$filter("filter")(places,{id:geofencePlace})[0];$scope.geofence.address=place.address,$scope.geofence.area.lat=place.location.lat,$scope.geofence.area.lng=place.location.lng,$scope.filteredDepartments=$filter("filter")($scope.departments,{place_id:place.id})},angular.extend($scope,{defaults:{maxZoom:22}}),angular.extend($scope,{layers:{baselayers:{osm:{name:"OpenStreetMap",type:"xyz",url:"http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",layerOptions:{attribution:'&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',continuousWorld:!0,maxZoom:22,maxNativeZoom:18}}}}}),$scope.location={lat:0,lng:0,zoom:18};var mapLoaded=!1;$scope.loadMap=function(){mapLoaded||(mapLoaded=!0,$scope.location.lat=$scope.geofence.area.lat,$scope.location.lng=$scope.geofence.area.lng,leafletData.getMap().then(function(map){setTimeout(function(){var image="";angular.forEach($scope.floors,function(value,key){var anchors=[];$scope.floors[key].floorplan_image_url?(console.log($scope.floors[key].floorplan_image_url),$scope.floors[key].anchors&&(anchors=[[$scope.floors[key].anchors[0].lat,$scope.floors[key].anchors[0].lng],[$scope.floors[key].anchors[1].lat,$scope.floors[key].anchors[1].lng],[$scope.floors[key].anchors[2].lat,$scope.floors[key].anchors[2].lng],[$scope.floors[key].anchors[3].lat,$scope.floors[key].anchors[3].lng]],image=L.imageTransform($scope.floors[key].floorplan_image_url,anchors,{opacity:.7})),map.addLayer(image)):console.log("nemam")}),angular.extend($scope,{markers:{}});var featureGroup=L.featureGroup().addTo(map),circle_options={color:"#fff",opacity:1,weight:10,fillColor:"#000",fillOpacity:.6};console.log($scope.geofence);L.circle([$scope.geofence.area.lat,$scope.geofence.area.lng],$scope.geofence.radius,circle_options).addTo(featureGroup),new L.Control.Draw({draw:!1,edit:{featureGroup:featureGroup,remove:!1}}).addTo(map);map.on("draw:created",function(e){var layer=e.layer;featureGroup.addLayer(layer),console.log(JSON.stringify(layer.toGeoJSON()))}),map.on("draw:edited",function(e){var layers=e.layers;layers.eachLayer(function(layer){$scope.geofence.area.lat=layer._latlng.lat,$scope.geofence.area.lng=layer._latlng.lng,$scope.geofence.radius=layer._mRadius})}),map.invalidateSize()},500)}))},$scope.ok=function(){$modalInstance.close($scope.geofence)},$scope.cancel=function(){$modalInstance.dismiss("cancel")}}]).controller("ShowGeofenceModalCtrl",["$scope","$modalInstance","geofence",function($scope,$modalInstance,geofence){$scope.geofence=geofence,$scope.cancel=function(){$modalInstance.dismiss("cancel")}}]),app.controller("DebugCtrl",["$scope","$filter","ngTableParams","compressArray","$timeout","$firebaseArray","FBURL",function($scope,$filter,ngTableParams,compressArray,$timeout,$firebaseArray,FBURL){$scope.page={title:"Debug",subtitle:"Debug all the events"};var organization,ref=new Firebase(FBURL);$scope.currentUser.$promise.then(function(){organization=$scope.currentUser.organization_id,$scope.events=$firebaseArray(ref.child("organizations").child(organization).child("global")),$scope.events.$loaded().then(function(){$scope.$watchCollection("events",function(){$scope.tableParams.reload()}),$scope.tableParams=new ngTableParams({page:1,count:10,sorting:{event:"asc"}},{total:$scope.events.length,getData:function($defer,params){var orderedData=params.sorting()?$filter("orderBy")($scope.events,params.orderBy()):$scope.events;params.total(orderedData.length),$defer.resolve(orderedData.slice((params.page()-1)*params.count(),params.page()*params.count()))}})})})}]),app.controller("ApplicationsCtrl",["$scope","$modal","$log","$filter","ngTableParams","toastr","Application","EventsService",function($scope,$modal,$log,$filter,ngTableParams,toastr,Application,EventsService){function getList(){Application.find({},function(list){$scope.applications=list},function(errorResponse){console.log(errorResponse)})}$scope.page={title:"Manage Applications",subtitle:"subtitle goes here"},$scope.applications=[],getList(),$scope.openModal=function(application){$scope.editing=!1,application?($scope.application=application,$scope.editing=!0):$scope.application={name:"",type:"mobile",settings:{gpsgeofences:!1,ibeacons:!1,indooratlas:!1,steerpath:!1,eddystone:!1}};var modalInstance=$modal.open({templateUrl:"applicationModal.html",controller:"ApplicationsModalCtrl",resolve:{application:function(){return $scope.application},editing:function(){return $scope.editing}}});modalInstance.result.then(function(application){var runOperation=function(){$scope.application={name:"",type:"mobile",settings:{gpsgeofences:!1,ibeacons:!1,indooratlas:!1,steerpath:!1,eddystone:!1}}};Application.upsert(application,function(res){$scope.editing===!1?toastr.success("New application has been created","Application Created!"):toastr.success("Application changes has been saved","Application Updated!"),runOperation(),getList()},function(res){console.log(res)})},function(){getList(),$log.info("Modal dismissed at: "+new Date)})},$scope.show=function(application){$scope.application=application,$modal.open({templateUrl:"applicationViewModal.html",controller:"ShowApplicationModalCtrl",resolve:{application:function(){return $scope.application}}})},$scope["delete"]=function(application){alertify.confirm("Are you sure you want to delete this application?").set({transition:"zoom"}).set("title","Alert!").set("onok",function(closeEvent){Application.deleteById({id:application.id},function(res){console.log(res),getList(),toastr.success("Application has been removed","Application Removed!")},function(res){console.log(res)})}).set("oncancel",function(closeEvent){console.log("Cancel")})},$scope.getToken=function(application){var app=$filter("filter")($scope.currentUser.tokens,application,!0)[0],token="null";app&&(token=Object.keys(app)[0]),alertify.alert("<pre>"+token+"</pre>").set({transition:"zoom"}).set("title","Application Token!").set("onok",function(closeEvent){console.log("close")})},$scope.$watchCollection("applications",function(){$scope.tableParams.reload()}),$scope.tableParams=new ngTableParams({page:1,count:10,sorting:{name:"asc"}},{total:$scope.applications.length,getData:function($defer,params){var orderedData=params.sorting()?$filter("orderBy")($scope.applications,params.orderBy()):$scope.applications;params.total(orderedData.length),$defer.resolve(orderedData.slice((params.page()-1)*params.count(),params.page()*params.count()))}})}]).controller("ApplicationsModalCtrl",["$scope","$modalInstance","application","editing",function($scope,$modalInstance,application,editing){$scope.application=application,$scope.editing=editing,$scope.ok=function(){$modalInstance.close($scope.application)},$scope.cancel=function(){$modalInstance.dismiss("cancel")}}]).controller("ShowApplicationModalCtrl",["$scope","$modalInstance","application",function($scope,$modalInstance,application){$scope.application=application,$scope.cancel=function(){$modalInstance.dismiss("cancel")}}]),app.controller("AnalyticsCtrl",["$scope","$stateParams","leafletData","$filter","Visitor","Floor","Analytics",function($scope,$stateParams,leafletData,$filter,Visitor,Floor,Analytics){function tagsChart(){$scope.donutData=[],angular.forEach($scope.analytics.visitor.tags,function(value,key){$scope.donutData.push({label:value.group[0],value:value.reduction})})}function heatMap(){$scope.heatmapPoints=[],angular.forEach($scope.analytics.visitor.positions,function(value,key){value&&value.lat&&value.lng&&$scope.heatmapPoints.push([value.lat,value.lng])}),$scope.heatmapPoints.length>0&&($scope.lastPosition=$scope.heatmapPoints.pop(),$scope.center={lat:parseFloat($scope.lastPosition[0]),lng:parseFloat($scope.lastPosition[1]),zoom:18}),leafletData.getMap().then(function(map){function initializeHeatmap(){$scope.layers.overlays={heat:{name:"Heat Map",type:"heat",data:$scope.heatmapPoints,layerOptions:{radius:25,blur:30},visible:!0}},$scope.layers.overlays.heat.doRefresh=!0}var image="";angular.forEach($scope.floors,function(value,key){var anchors=[];$scope.floors[key].floorplan_image_url&&($scope.floors[key].anchors&&(anchors=[[$scope.floors[key].anchors[0].lat,$scope.floors[key].anchors[0].lng],[$scope.floors[key].anchors[1].lat,$scope.floors[key].anchors[1].lng],[$scope.floors[key].anchors[2].lat,$scope.floors[key].anchors[2].lng],[$scope.floors[key].anchors[3].lat,$scope.floors[key].anchors[3].lng]],image=L.imageTransform($scope.floors[key].floorplan_image_url,anchors,{opacity:.7})),map.addLayer(image))}),initializeHeatmap()})}$scope.page={title:"Analytics",subtitle:"subtitle goes here"};var id=$stateParams.id;$scope.floors=Floor.find(),$scope.analytics=Analytics.getVisitor({id:id},function(){tagsChart(),heatMap()},function(errorResponse){console.log(errorResponse)}),console.log($scope.analytics),$scope.center={lat:0,lng:0,zoom:22},angular.extend($scope,{layers:{baselayers:{osm:{name:"OpenStreetMap",type:"xyz",url:"http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",layerOptions:{subdomains:["a","b","c"],attribution:'&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',continuousWorld:!0,maxZoom:22,maxNativeZoom:18}}}}}),$scope.getSnippet=function(target){var content;content="curl -X GET \\ \n--header 'Content-Type: application/json' \\ \n--header 'Accept: application/json' \\ \n--header 'Authorization: Bearer "+$scope.currentUser.data.token+"' \\ \n'https://api.proximi.fi/core/"+target+"/"+id+"'",alertify.alert("<pre>"+content+"</pre>").set({transition:"zoom"}).set("title","Get CURL snippet!").set("onok",function(closeEvent){console.log("close")})}}]),app.controller("ReportsCtrl",["$scope","$filter","ngTableParams","compressArray","$moment","leafletData","$timeout","toastr","Analytics","Floor",function($scope,$filter,ngTableParams,compressArray,$moment,leafletData,$timeout,toastr,Analytics,Floor){function getList(){Analytics.getOverview({date_from:$filter("date")($scope.myDates.startDate,"yyyy-MM-dd"),date_to:$filter("date")($scope.myDates.endDate,"yyyy-MM-dd"),place_id:$scope.filters.place},function(list){$scope.analytics=list,console.log(list),loadChart(),heatMap()},function(errorResponse){console.log(errorResponse)})}function loadChart(){$scope.dataset=[];var ticks=[],yAxisData=[],firstDate=parseInt(moment($scope.myDates.startDate).startOf("day").format("x"))+864e5,lastDate=parseInt(moment($scope.myDates.endDate).endOf("day").format("x"))-864e5,dayDuration=864e5,x=(lastDate-firstDate)/dayDuration;$scope.options={series:{shadowSize:0},legend:{backgroundOpacity:0,margin:-7,position:"ne",noColumns:2},xaxis:{tickLength:0,font:{color:"#fff"},position:"bottom",ticks:ticks},yaxis:{tickLength:0,tickDecimals:0,font:{color:"#fff"}},grid:{borderWidth:{top:0,right:0,bottom:1,left:1},borderColor:"rgba(255,255,255,.3)",margin:0,minBorderMargin:0,labelMargin:20,hoverable:!0,clickable:!0,mouseActiveRadius:6},tooltip:!0,tooltipOpts:{content:"%s: %y",defaultTheme:!1,shifts:{x:0,y:20}}};for(var i=0;x>i;i++)ticks.push([parseInt(firstDate),$filter("date")(firstDate,"dd MMM")]),yAxisData.push([parseInt(firstDate),0]),firstDate=parseInt(firstDate)+dayDuration;angular.forEach($scope.analytics.chart,function(chart,chart_key){0===$filter("filter")($scope.dataset,{label:chart.group[1]},!0).length&&$scope.dataset.push({data:angular.copy(yAxisData),label:chart.group[1],id:chart.group[2],points:{show:!0,radius:4},splines:{show:!0,tension:.45,lineWidth:4,fill:.1}});var timestamp=moment([chart.group[0][0],chart.group[0][1]-1,chart.group[0][2]]).format("x"),dataset=$filter("filter")($scope.dataset,{id:chart.group[2]},!0)[0];$filter("filter")(dataset.data,parseInt(timestamp),!0)[0][1]=chart.reduction}),$scope.newVisitorsChart.percent=100-$scope.analytics.visitors.loyalty,$scope.returningVisitorsChart.percent=$scope.analytics.visitors.loyalty,$scope.loyaltyChart.percent=$scope.analytics.visitors.loyalty}function heatMap(){$scope.heatmapPoints=[],angular.forEach($scope.analytics.positions,function(value,key){value&&value.lat&&value.lng&&$scope.heatmapPoints.push([value.lat,value.lng])}),$scope.heatmapPoints.length>0&&($scope.lastPosition=$scope.heatmapPoints.pop(),$scope.center={lat:parseFloat($scope.lastPosition[0]),lng:parseFloat($scope.lastPosition[1]),zoom:18}),leafletData.getMap().then(function(map){function initializeHeatmap(){$scope.layers.overlays={heat:{name:"Heat Map",type:"heat",data:$scope.heatmapPoints,layerOptions:{radius:25,blur:30},visible:!0}},$scope.layers.overlays.heat.doRefresh=!0}var image="";angular.forEach($scope.floors,function(value,key){var anchors=[];$scope.floors[key].floorplan_image_url&&($scope.floors[key].anchors&&(anchors=[[$scope.floors[key].anchors[0].lat,$scope.floors[key].anchors[0].lng],[$scope.floors[key].anchors[1].lat,$scope.floors[key].anchors[1].lng],[$scope.floors[key].anchors[2].lat,$scope.floors[key].anchors[2].lng],[$scope.floors[key].anchors[3].lat,$scope.floors[key].anchors[3].lng]],image=L.imageTransform($scope.floors[key].floorplan_image_url,anchors,{opacity:.7})),map.addLayer(image))}),initializeHeatmap()})}toastr.info("Analytics are available also for the Putter/Midrange Subscription during the beta!","Attention!",{closeButton:!0,timeOut:15e3,extendedTimeOut:1e4,progressBar:!0}),$scope.page={title:"Analytics & Reporting",subtitle:"subtitle goes here"},$scope.myDates={startDate:moment().subtract(29,"days").startOf("day").format(),endDate:moment().add(1,"days").endOf("day").format()},$scope.config1={format:"Do MMM YYYY",shortcuts:[{name:"Today",from:moment().startOf("day"),to:moment().endOf("day")},{name:"Yesterday",from:moment().subtract(1,"days").startOf("day"),to:moment().subtract(1,"days").endOf("day")},{name:"Last 30 Days",from:moment().subtract(29,"days").startOf("day"),to:moment().endOf("day")},{name:"This Week",from:moment().startOf("week"),to:moment().endOf("week")},{name:"Last Week",from:moment().subtract(1,"week").startOf("week"),to:moment().subtract(1,"week").endOf("week")},{name:"This Month",from:moment().startOf("month"),to:moment().endOf("month")},{name:"Last Month",from:moment().subtract(1,"month").startOf("month"),to:moment().subtract(1,"month").endOf("month")}]},$scope.filters={place:null,isOpen:!1},$scope.filtered=!1,$scope.floors=Floor.find(),$scope.analytics=[],getList(),$scope.$watch("myDates",function(newVal,oldVal){newVal!==oldVal&&getList()},!0),$scope.placeFilter=function(){$scope.filtered?$scope.filters.place=$scope.dataset[0].id:(getList(),$scope.filtered=!0)},$scope.resetFilters=function(){$scope.filters.isOpen=!1,$scope.filters.place=null,$scope.filtered=!1,getList()},$scope.visitsChart={options:{animate:{duration:3e3,enabled:!0},barColor:"#a2d200",scaleColor:!1,lineCap:"round",size:140,lineWidth:4}},$scope.visitorsChart={options:{animate:{duration:3e3,enabled:!0},barColor:"#418bca",scaleColor:!1,lineCap:"round",size:140,lineWidth:4}},$scope.newVisitorsChart={percent:0,options:{animate:{duration:3e3,enabled:!0},barColor:"#e05d6f",scaleColor:!1,lineCap:"round",size:140,lineWidth:4}},$scope.returningVisitorsChart={percent:0,options:{animate:{duration:3e3,enabled:!0},barColor:"#16a085",scaleColor:!1,lineCap:"round",size:140,lineWidth:4}},$scope.loyaltyChart={percent:0,options:{animate:{duration:3e3,enabled:!0},barColor:"#f0ad4e",scaleColor:!1,lineCap:"round",size:140,lineWidth:4}},$scope.center={lat:0,lng:0,zoom:22},angular.extend($scope,{layers:{baselayers:{osm:{name:"OpenStreetMap",type:"xyz",url:"http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",layerOptions:{subdomains:["a","b","c"],attribution:'&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',continuousWorld:!0,maxZoom:22,maxNativeZoom:18}}}}}),$scope.getSnippet=function(target){var content;content="curl -X GET \\ \n--header 'Content-Type: application/json' \\ \n--header 'Accept: application/json' \\ \n--header 'Authorization: Bearer "+$scope.currentUser.data.token+"' \\ \n'https://api.proximi.fi/core/"+target+"/?date_from="+$filter("date")($scope.myDates.startDate,"yyyy-MM-dd")+"&date_to="+$filter("date")($scope.myDates.endDate,"yyyy-MM-dd")+"'",alertify.alert("<pre>"+content+"</pre>").set({transition:"zoom"}).set("title","Get CURL snippet!").set("onok",function(closeEvent){console.log("close")})}}]),app.controller("AccountCtrl",["$scope","toastr","User","$modal","$log",function($scope,toastr,User,$modal,$log){$scope.page={title:"My Account",subtitle:"subtitle goes here"},$scope.user=$scope.currentUser,$scope.backgrounds=["Freelance developer","Developer in a software development company","In-house developer","Researcher","I do marketing","I do sales","Other"],$scope.plans=["Putter","Midrange","Driver"],$scope.password={},$scope.saveUser=function(){console.log($scope.user)},$scope.orderModal=function(size){$scope.order={};var modalInstance=$modal.open({templateUrl:"orderModal.html",controller:"OrderModalCtrl",size:size,scope:$scope});modalInstance.result.then(function(){},function(){$log.info("Modal dismissed at: "+new Date)})},$scope.passwordModal=function(size){var modalInstance=$modal.open({templateUrl:"passwordModal.html",controller:"PasswordModalCtrl",size:size,scope:$scope});modalInstance.result.then(function(){console.log($scope.password)},function(){$log.info("Modal dismissed at: "+new Date)})}}]).controller("OrderModalCtrl",["$scope","$modalInstance","toastr",function($scope,$modalInstance,toastr){function stripeResponseHandler(status,response){console.log(response,$scope.order),response.error?($scope.order.postingStripe=!1,$scope.$apply(),toastr.error(response.error.message,"Order Error!")):($modalInstance.close(),toastr.success("Your order has been placed","Order Success!"))}Stripe.setPublishableKey("pk_test_3ktpDT2xX9ojUd3VNrR1g6Jq"),$scope.order.postingStripe=!1,$scope.ok=function(){$scope.order.postingStripe||($scope.order.postingStripe=!0,Stripe.card.createToken({number:$scope.order.card_number,exp_month:$scope.order.card_expiration_month,exp_year:$scope.order.card_expiration_year,cvc:$scope.order.card_cvc},stripeResponseHandler))},$scope.cancel=function(){$modalInstance.dismiss("cancel")}}]).controller("PasswordModalCtrl",["$scope","$modalInstance",function($scope,$modalInstance){$scope.ok=function(){$modalInstance.close()},$scope.cancel=function(){$modalInstance.dismiss("cancel")}}]),app.factory("MorrisPost",["$firebaseArray","FBURL",function($firebaseArray,FBURL){var ref=new Firebase(FBURL),morrisPosts=$firebaseArray(ref.child("morrisPosts")),MorrisPost={
all:morrisPosts,create:function(morrisPost){return morrisPosts.$add(morrisPost)},"delete":function(morrisPost){return morrisPosts.$remove(morrisPost)}};return MorrisPost}]),app.factory("Geocoder",["$localStorage","$q","$timeout","$rootScope",function($localStorage,$q,$timeout,$rootScope){var locations=$localStorage.locations?JSON.parse($localStorage.locations):{},queue=[],QUERY_PAUSE=250,executeNext=function(){var task=queue[0],geocoder=new google.maps.Geocoder;geocoder.geocode({address:task.address},function(result,status){if(status===google.maps.GeocoderStatus.OK){var parsedResult={lat:result[0].geometry.location.lat(),lng:result[0].geometry.location.lng(),formattedAddress:result[0].formatted_address};locations[task.address]=parsedResult,$localStorage.locations=JSON.stringify(locations),queue.shift(),task.d.resolve(parsedResult)}else status===google.maps.GeocoderStatus.ZERO_RESULTS?(queue.shift(),task.d.reject({type:"zero",message:"Zero results for geocoding address "+task.address})):status===google.maps.GeocoderStatus.OVER_QUERY_LIMIT?task.executedAfterPause&&(queue.shift(),task.d.reject({type:"busy",message:"Geocoding server is busy can not process address "+task.address})):status===google.maps.GeocoderStatus.REQUEST_DENIED?(queue.shift(),task.d.reject({type:"denied",message:"Request denied for geocoding address "+task.address})):(queue.shift(),task.d.reject({type:"invalid",message:"Invalid request for geocoding: status="+status+", address="+task.address}));if(queue.length)if(status===google.maps.GeocoderStatus.OVER_QUERY_LIMIT){var nextTask=queue[0];nextTask.executedAfterPause=!0,$timeout(executeNext,QUERY_PAUSE)}else $timeout(executeNext,0);$rootScope.$$phase||$rootScope.$apply()})};return{geocodeAddress:function(address){var d=$q.defer();return _.has(locations,address)?d.resolve(locations[address]):(queue.push({address:address,d:d}),1===queue.length&&executeNext()),d.promise}}}]),app.factory("compressArray",function(){return function(original){for(var compressed=[],copy=original.slice(0),i=0;i<original.length;i++){for(var myCount=0,w=0;w<copy.length;w++)original[i]===copy[w]&&(myCount++,delete copy[w]);if(myCount>0){var a=new Object({});a.label=original[i],a.data=myCount,compressed.push(a)}}return compressed}}),app.filter("unixToTimeString",function(){return function(millseconds){var seconds=Math.floor(millseconds/1e3),days=Math.floor(seconds/86400),hours=Math.floor(seconds%86400/3600),minutes=Math.floor(seconds%86400%3600/60),timeString="";return days>0&&(timeString+=days>1?days+" days ":days+" day "),hours>0&&(timeString+=hours>1?hours+" hours ":hours+" hour "),minutes>=0&&(timeString+=minutes>1?minutes+" minutes ":minutes+" minute "),timeString}}),app.filter("object2Array",function(){return function(input){var i,out=[];for(i in input)out.push(input[i]);return out}}),function(window,angular,undefined){function getHost(url){var m=url.match(/^(?:https?:)?\/\/([^\/]+)/);return m?m[1]:null}var apiBase=window.location.protocol+"//api.proximi.fi",urlBase=apiBase+"/core",authHeader="authorization",urlBaseHost=getHost(urlBase)||location.host,module=angular.module("lbServices",["ngResource"]);module.factory("User",["LoopBackResource","LoopBackAuth","$injector",function(Resource,LoopBackAuth,$injector){var R=Resource(apiBase+"/core_auth",{},{prototype$__findById__accessTokens:{params:{fk:"@fk"},url:urlBase+"/Users/:id/accessTokens/:fk",method:"GET"},prototype$__destroyById__accessTokens:{params:{fk:"@fk"},url:urlBase+"/Users/:id/accessTokens/:fk",method:"DELETE"},prototype$__updateById__accessTokens:{params:{fk:"@fk"},url:urlBase+"/Users/:id/accessTokens/:fk",method:"PUT"},prototype$__get__accessTokens:{isArray:!0,url:urlBase+"/Users/:id/accessTokens",method:"GET"},prototype$__create__accessTokens:{url:urlBase+"/Users/:id/accessTokens",method:"POST"},prototype$__delete__accessTokens:{url:urlBase+"/Users/:id/accessTokens",method:"DELETE"},prototype$__count__accessTokens:{url:urlBase+"/Users/:id/accessTokens/count",method:"GET"},create:{url:urlBase+"/Users",method:"POST"},createMany:{isArray:!0,url:urlBase+"/Users",method:"POST"},upsert:{url:urlBase+"/Users",method:"PUT"},exists:{url:urlBase+"/Users/:id/exists",method:"GET"},findById:{url:apiBase+"/core_auth",method:"GET"},find:{isArray:!0,url:apiBase+"/core_auth",method:"GET"},findOne:{url:urlBase+"/Users/findOne",method:"GET"},updateAll:{url:urlBase+"/Users/update",method:"POST"},deleteById:{url:urlBase+"/Users/:id/delete",method:"DELETE"},count:{url:urlBase+"/Users/count",method:"GET"},prototype$updateAttributes:{url:apiBase+"/core_auth",method:"PUT"},createChangeStream:{url:urlBase+"/Users/change-stream",method:"POST"},login:{params:{},interceptor:{response:function(response){console.log("login response",response);var accessToken=response.data.token;return LoopBackAuth.setUser(accessToken,response.data.user),LoopBackAuth.save(),response.resource}},url:apiBase+"/core_auth/login",method:"POST"},register:{params:{},interceptor:{response:function(response){console.log("register response",response);var authorizationToken=response.data.token;return LoopBackAuth.setUser(authorizationToken,response.data.user),LoopBackAuth.save(),response.resource}},url:apiBase+"/core_auth/registration",method:"POST"},logout:{interceptor:{response:function(response){return LoopBackAuth.clearUser(),LoopBackAuth.clearStorage(),response.resource}},url:apiBase+"/core_auth/logout",method:"POST"},confirm:{url:urlBase+"/Users/confirm",method:"GET"},resetPassword:{url:urlBase+"/Users/reset",method:"POST"},getCurrent:{url:apiBase+"/core/current_user",method:"GET",params:{id:function(){var id=LoopBackAuth.currentUserId;return null==id&&(id="__anonymous__"),id}},interceptor:{response:function(response){return response.resource}},__isGetCurrentUser__:!0}});return R.updateOrCreate=R.upsert,R.update=R.updateAll,R.destroyById=R.deleteById,R.removeById=R.deleteById,R.getCachedCurrent=function(){var data=LoopBackAuth.currentUserData;return data?new R(data):null},R.isAuthenticated=function(){return null!=this.getCurrentId()},R.getCurrentId=function(){return LoopBackAuth.currentUserId},R.modelName="User",R}]),module.factory("Place",["LoopBackResource","LoopBackAuth","$injector",function(Resource,LoopBackAuth,$injector){var R=Resource(urlBase+"/places/:id",{id:"@id"},{prototype$__findById__floors:{params:{fk:"@fk"},url:urlBase+"/places/:id/floors/:fk",method:"GET"},prototype$__destroyById__floors:{params:{fk:"@fk"},url:urlBase+"/places/:id/floors/:fk",method:"DELETE"},prototype$__updateById__floors:{params:{fk:"@fk"},url:urlBase+"/places/:id/floors/:fk",method:"PUT"},prototype$__findById__departments:{params:{fk:"@fk"},url:urlBase+"/places/:id/departments/:fk",method:"GET"},prototype$__destroyById__departments:{params:{fk:"@fk"},url:urlBase+"/places/:id/departments/:fk",method:"DELETE"},prototype$__updateById__departments:{params:{fk:"@fk"},url:urlBase+"/places/:id/departments/:fk",method:"PUT"},prototype$__get__organization:{url:urlBase+"/places/:id/organization",method:"GET"},prototype$__get__floors:{isArray:!0,url:urlBase+"/places/:id/floors",method:"GET"},prototype$__create__floors:{url:urlBase+"/places/:id/floors",method:"POST"},prototype$__delete__floors:{url:urlBase+"/places/:id/floors",method:"DELETE"},prototype$__count__floors:{url:urlBase+"/places/:id/floors/count",method:"GET"},prototype$__get__departments:{isArray:!0,url:urlBase+"/places/:id/departments",method:"GET"},prototype$__create__departments:{url:urlBase+"/places/:id/departments",method:"POST"},prototype$__delete__departments:{url:urlBase+"/places/:id/departments",method:"DELETE"},prototype$__count__departments:{url:urlBase+"/places/:id/departments/count",method:"GET"},create:{url:urlBase+"/places",method:"POST"},createMany:{isArray:!0,url:urlBase+"/places",method:"POST"},upsert:{url:urlBase+"/places",method:"PUT"},exists:{url:urlBase+"/places/:id/exists",method:"GET"},findById:{url:urlBase+"/places/:id",method:"GET"},find:{isArray:!0,url:urlBase+"/places",method:"GET"},findOne:{url:urlBase+"/places/findOne",method:"GET"},updateAll:{url:urlBase+"/places/update",method:"POST"},deleteById:{url:urlBase+"/places/:id",method:"DELETE"},count:{url:urlBase+"/places/count",method:"GET"},prototype$updateAttributes:{url:urlBase+"/places/:id",method:"PUT"},createChangeStream:{url:urlBase+"/places/change-stream",method:"POST"},prototype$__findById__floors__departments:{params:{nk:"@nk",fk:"@fk"},url:urlBase+"/places/:id/floors/:nk/departments/:fk",method:"GET"},prototype$__destroyById__floors__departments:{params:{nk:"@nk",fk:"@fk"},url:urlBase+"/places/:id/floors/:nk/departments/:fk",method:"DELETE"},prototype$__updateById__floors__departments:{params:{nk:"@nk",fk:"@fk"},url:urlBase+"/places/:id/floors/:nk/departments/:fk",method:"PUT"},prototype$__get__floors__organization:{params:{nk:"@nk"},url:urlBase+"/places/:id/floors/:nk/organization",method:"GET"},prototype$__get__floors__departments:{isArray:!0,params:{nk:"@nk"},url:urlBase+"/places/:id/floors/:nk/departments",method:"GET"},prototype$__create__floors__departments:{params:{nk:"@nk"},url:urlBase+"/places/:id/floors/:nk/departments",method:"POST"},prototype$__delete__floors__departments:{params:{nk:"@nk"},url:urlBase+"/places/:id/floors/:nk/departments",method:"DELETE"},prototype$__count__floors__departments:{url:urlBase+"/places/:id/floors/:nk/departments/count",method:"GET"},"::findById::organization::places":{params:{fk:"@fk"},url:urlBase+"/organizations/:id/places/:fk",method:"GET"},"::destroyById::organization::places":{params:{fk:"@fk"},url:urlBase+"/organizations/:id/places/:fk",method:"DELETE"},"::updateById::organization::places":{params:{fk:"@fk"},url:urlBase+"/organizations/:id/places/:fk",method:"PUT"},"::get::organization::places":{isArray:!0,url:urlBase+"/organizations/:id/places",method:"GET"},"::create::organization::places":{url:urlBase+"/organizations/:id/places",method:"POST"},"::createMany::organization::places":{isArray:!0,url:urlBase+"/organizations/:id/places",method:"POST"},"::delete::organization::places":{url:urlBase+"/organizations/:id/places",method:"DELETE"},"::count::organization::places":{url:urlBase+"/organizations/:id/places/count",method:"GET"}});return R.updateOrCreate=R.upsert,R.update=R.updateAll,R.destroyById=R.deleteById,R.removeById=R.deleteById,R.modelName="Place",R.floors=function(){var TargetResource=$injector.get("Floor"),action=TargetResource["::get::place::floors"];return action.apply(R,arguments)},R.floors.count=function(){var TargetResource=$injector.get("Floor"),action=TargetResource["::count::place::floors"];return action.apply(R,arguments)},R.floors.create=function(){var TargetResource=$injector.get("Floor"),action=TargetResource["::create::place::floors"];return action.apply(R,arguments)},R.floors.createMany=function(){var TargetResource=$injector.get("Floor"),action=TargetResource["::createMany::place::floors"];return action.apply(R,arguments)},R.floors.destroyAll=function(){var TargetResource=$injector.get("Floor"),action=TargetResource["::delete::place::floors"];return action.apply(R,arguments)},R.floors.destroyById=function(){var TargetResource=$injector.get("Floor"),action=TargetResource["::destroyById::place::floors"];return action.apply(R,arguments)},R.floors.findById=function(){var TargetResource=$injector.get("Floor"),action=TargetResource["::findById::place::floors"];return action.apply(R,arguments)},R.floors.updateById=function(){var TargetResource=$injector.get("Floor"),action=TargetResource["::updateById::place::floors"];return action.apply(R,arguments)},R.departments=function(){var TargetResource=$injector.get("Department"),action=TargetResource["::get::place::departments"];return action.apply(R,arguments)},R.departments.count=function(){var TargetResource=$injector.get("Department"),action=TargetResource["::count::place::departments"];return action.apply(R,arguments)},R.departments.create=function(){var TargetResource=$injector.get("Department"),action=TargetResource["::create::place::departments"];return action.apply(R,arguments)},R.departments.createMany=function(){var TargetResource=$injector.get("Department"),action=TargetResource["::createMany::place::departments"];return action.apply(R,arguments)},R.departments.destroyAll=function(){var TargetResource=$injector.get("Department"),action=TargetResource["::delete::place::departments"];return action.apply(R,arguments)},R.departments.destroyById=function(){var TargetResource=$injector.get("Department"),action=TargetResource["::destroyById::place::departments"];return action.apply(R,arguments)},R.departments.findById=function(){var TargetResource=$injector.get("Department"),action=TargetResource["::findById::place::departments"];return action.apply(R,arguments)},R.departments.updateById=function(){var TargetResource=$injector.get("Department"),action=TargetResource["::updateById::place::departments"];return action.apply(R,arguments)},R.organization=function(){var TargetResource=$injector.get("Organization"),action=TargetResource["::get::place::organization"];return action.apply(R,arguments)},R}]),module.factory("Geofence",["LoopBackResource","LoopBackAuth","$injector",function(Resource,LoopBackAuth,$injector){var R=Resource(urlBase+"/geofences/:id",{id:"@id"},{create:{url:urlBase+"/geofences",method:"POST"},createMany:{isArray:!0,url:urlBase+"/geofences",method:"POST"},upsert:{url:urlBase+"/geofences",method:"PUT"},exists:{url:urlBase+"/geofences/:id/exists",method:"GET"},findById:{url:urlBase+"/geofences/:id",method:"GET"},find:{isArray:!0,url:urlBase+"/geofences",method:"GET"},findOne:{url:urlBase+"/geofences/findOne",method:"GET"},updateAll:{url:urlBase+"/geofences/update",method:"POST"},deleteById:{url:urlBase+"/geofences/:id",method:"DELETE"},count:{url:urlBase+"/geofences/count",method:"GET"},prototype$updateAttributes:{url:urlBase+"/geofences/:id",method:"PUT"},createChangeStream:{url:urlBase+"/geofences/change-stream",method:"POST"}});return R.updateOrCreate=R.upsert,R.update=R.updateAll,R.destroyById=R.deleteById,R.removeById=R.deleteById,R.modelName="Geofence",R}]),module.factory("Floor",["LoopBackResource","LoopBackAuth","$injector",function(Resource,LoopBackAuth,$injector){var R=Resource(urlBase+"/floors/:id",{id:"@id"},{prototype$__findById__departments:{params:{fk:"@fk"},url:urlBase+"/floors/:id/departments/:fk",method:"GET"},prototype$__destroyById__departments:{params:{fk:"@fk"},url:urlBase+"/floors/:id/departments/:fk",method:"DELETE"},prototype$__updateById__departments:{params:{fk:"@fk"},url:urlBase+"/floors/:id/departments/:fk",method:"PUT"},prototype$__get__organization:{url:urlBase+"/floors/:id/organization",method:"GET"},prototype$__get__departments:{isArray:!0,url:urlBase+"/floors/:id/departments",method:"GET"},prototype$__create__departments:{url:urlBase+"/floors/:id/departments",method:"POST"},prototype$__delete__departments:{url:urlBase+"/floors/:id/departments",method:"DELETE"},prototype$__count__departments:{url:urlBase+"/floors/:id/departments/count",method:"GET"},create:{url:urlBase+"/floors",method:"POST"},createMany:{isArray:!0,url:urlBase+"/floors",method:"POST"},upsert:{url:urlBase+"/floors",method:"PUT"},exists:{url:urlBase+"/floors/:id/exists",method:"GET"},findById:{url:urlBase+"/floors/:id",method:"GET"},find:{isArray:!0,url:urlBase+"/floors",method:"GET"},findOne:{url:urlBase+"/floors/findOne",method:"GET"},updateAll:{url:urlBase+"/floors/update",method:"POST"},deleteById:{url:urlBase+"/floors/:id",method:"DELETE"},count:{url:urlBase+"/floors/count",method:"GET"},prototype$updateAttributes:{url:urlBase+"/floors/:id",method:"PUT"},createChangeStream:{url:urlBase+"/floors/change-stream",method:"POST"},"::findById::place::floors":{params:{fk:"@fk"},url:urlBase+"/places/:id/floors/:fk",method:"GET"},"::destroyById::place::floors":{params:{fk:"@fk"},url:urlBase+"/places/:id/floors/:fk",method:"DELETE"},"::updateById::place::floors":{params:{fk:"@fk"},url:urlBase+"/places/:id/floors/:fk",method:"PUT"},"::get::place::floors":{isArray:!0,url:urlBase+"/places/:id/floors",method:"GET"},"::create::place::floors":{url:urlBase+"/places/:id/floors",method:"POST"},"::createMany::place::floors":{isArray:!0,url:urlBase+"/places/:id/floors",method:"POST"},"::delete::place::floors":{url:urlBase+"/places/:id/floors",method:"DELETE"},"::count::place::floors":{url:urlBase+"/places/:id/floors/count",method:"GET"},"::findById::organization::floors":{params:{fk:"@fk"},url:urlBase+"/organizations/:id/floors/:fk",method:"GET"},"::destroyById::organization::floors":{params:{fk:"@fk"},url:urlBase+"/organizations/:id/floors/:fk",method:"DELETE"},"::updateById::organization::floors":{params:{fk:"@fk"},url:urlBase+"/organizations/:id/floors/:fk",method:"PUT"},"::get::organization::floors":{isArray:!0,url:urlBase+"/organizations/:id/floors",method:"GET"},"::create::organization::floors":{url:urlBase+"/organizations/:id/floors",method:"POST"},"::createMany::organization::floors":{isArray:!0,url:urlBase+"/organizations/:id/floors",method:"POST"},"::delete::organization::floors":{url:urlBase+"/organizations/:id/floors",method:"DELETE"},"::count::organization::floors":{url:urlBase+"/organizations/:id/floors/count",method:"GET"}});return R.updateOrCreate=R.upsert,R.update=R.updateAll,R.destroyById=R.deleteById,R.removeById=R.deleteById,R.modelName="Floor",R.departments=function(){var TargetResource=$injector.get("Department"),action=TargetResource["::get::floor::departments"];return action.apply(R,arguments)},R.departments.count=function(){var TargetResource=$injector.get("Department"),action=TargetResource["::count::floor::departments"];return action.apply(R,arguments)},R.departments.create=function(){var TargetResource=$injector.get("Department"),action=TargetResource["::create::floor::departments"];return action.apply(R,arguments)},R.departments.createMany=function(){var TargetResource=$injector.get("Department"),action=TargetResource["::createMany::floor::departments"];return action.apply(R,arguments)},R.departments.destroyAll=function(){var TargetResource=$injector.get("Department"),action=TargetResource["::delete::floor::departments"];return action.apply(R,arguments)},R.departments.destroyById=function(){var TargetResource=$injector.get("Department"),action=TargetResource["::destroyById::floor::departments"];return action.apply(R,arguments)},R.departments.findById=function(){var TargetResource=$injector.get("Department"),action=TargetResource["::findById::floor::departments"];return action.apply(R,arguments)},R.departments.updateById=function(){var TargetResource=$injector.get("Department"),action=TargetResource["::updateById::floor::departments"];return action.apply(R,arguments)},R.organization=function(){var TargetResource=$injector.get("Organization"),action=TargetResource["::get::floor::organization"];return action.apply(R,arguments)},R}]),module.factory("Department",["LoopBackResource","LoopBackAuth","$injector",function(Resource,LoopBackAuth,$injector){var R=Resource(urlBase+"/departments/:id",{id:"@id"},{create:{url:urlBase+"/departments",method:"POST"},createMany:{isArray:!0,url:urlBase+"/departments",method:"POST"},upsert:{url:urlBase+"/departments",method:"PUT"},exists:{url:urlBase+"/departments/:id/exists",method:"GET"},findById:{url:urlBase+"/departments/:id",method:"GET"},find:{isArray:!0,url:urlBase+"/departments",method:"GET"},findOne:{url:urlBase+"/departments/findOne",method:"GET"},updateAll:{url:urlBase+"/departments/update",method:"POST"},deleteById:{url:urlBase+"/departments/:id",method:"DELETE"},count:{url:urlBase+"/departments/count",method:"GET"},prototype$updateAttributes:{url:urlBase+"/departments/:id",method:"PUT"},createChangeStream:{url:urlBase+"/departments/change-stream",method:"POST"},"::findById::place::departments":{params:{fk:"@fk"},url:urlBase+"/places/:id/departments/:fk",method:"GET"},"::destroyById::place::departments":{params:{fk:"@fk"},url:urlBase+"/places/:id/departments/:fk",method:"DELETE"},"::updateById::place::departments":{params:{fk:"@fk"},url:urlBase+"/places/:id/departments/:fk",method:"PUT"},"::get::place::departments":{isArray:!0,url:urlBase+"/places/:id/departments",method:"GET"},"::create::place::departments":{url:urlBase+"/places/:id/departments",method:"POST"},"::createMany::place::departments":{isArray:!0,url:urlBase+"/places/:id/departments",method:"POST"},"::delete::place::departments":{url:urlBase+"/places/:id/departments",method:"DELETE"},"::count::place::departments":{url:urlBase+"/places/:id/departments/count",method:"GET"},"::findById::floor::departments":{params:{fk:"@fk"},url:urlBase+"/floors/:id/departments/:fk",method:"GET"},"::destroyById::floor::departments":{params:{fk:"@fk"},url:urlBase+"/floors/:id/departments/:fk",method:"DELETE"},"::updateById::floor::departments":{params:{fk:"@fk"},url:urlBase+"/floors/:id/departments/:fk",method:"PUT"},"::get::floor::departments":{isArray:!0,url:urlBase+"/floors/:id/departments",method:"GET"},"::create::floor::departments":{url:urlBase+"/floors/:id/departments",method:"POST"},"::createMany::floor::departments":{isArray:!0,url:urlBase+"/floors/:id/departments",method:"POST"},"::delete::floor::departments":{url:urlBase+"/floors/:id/departments",method:"DELETE"},"::count::floor::departments":{url:urlBase+"/floors/:id/departments/count",method:"GET"},"::findById::organization::departments":{params:{fk:"@fk"},url:urlBase+"/organizations/:id/departments/:fk",method:"GET"},"::destroyById::organization::departments":{params:{fk:"@fk"},url:urlBase+"/organizations/:id/departments/:fk",method:"DELETE"},"::updateById::organization::departments":{params:{fk:"@fk"},url:urlBase+"/organizations/:id/departments/:fk",method:"PUT"},"::get::organization::departments":{isArray:!0,url:urlBase+"/organizations/:id/departments",method:"GET"},"::create::organization::departments":{url:urlBase+"/organizations/:id/departments",method:"POST"},"::createMany::organization::departments":{isArray:!0,url:urlBase+"/organizations/:id/departments",method:"POST"},"::delete::organization::departments":{url:urlBase+"/organizations/:id/departments",method:"DELETE"},"::count::organization::departments":{url:urlBase+"/organizations/:id/departments/count",method:"GET"}});return R.updateOrCreate=R.upsert,R.update=R.updateAll,R.destroyById=R.deleteById,R.removeById=R.deleteById,R.modelName="Department",R}]),module.factory("Input",["LoopBackResource","LoopBackAuth","$injector",function(Resource,LoopBackAuth,$injector){var R=Resource(urlBase+"/inputs/:id",{id:"@id"},{create:{url:urlBase+"/inputs",method:"POST"},createMany:{isArray:!0,url:urlBase+"/inputs",method:"POST"},upsert:{url:urlBase+"/inputs",method:"PUT"},exists:{url:urlBase+"/inputs/:id/exists",method:"GET"},findById:{url:urlBase+"/inputs/:id",method:"GET"},find:{isArray:!0,url:urlBase+"/inputs",method:"GET"},findOne:{url:urlBase+"/inputs/findOne",method:"GET"},updateAll:{url:urlBase+"/inputs/update",method:"POST"},deleteById:{url:urlBase+"/inputs/:id",method:"DELETE"},count:{url:urlBase+"/inputs/count",method:"GET"},prototype$updateAttributes:{url:urlBase+"/inputs/:id",method:"PUT"},createChangeStream:{url:urlBase+"/inputs/change-stream",method:"POST"},"::findById::organization::inputs":{params:{fk:"@fk"},url:urlBase+"/organizations/:id/inputs/:fk",method:"GET"},"::destroyById::organization::inputs":{params:{fk:"@fk"},url:urlBase+"/organizations/:id/inputs/:fk",method:"DELETE"},"::updateById::organization::inputs":{params:{fk:"@fk"},url:urlBase+"/organizations/:id/inputs/:fk",method:"PUT"},"::get::organization::inputs":{isArray:!0,url:urlBase+"/organizations/:id/inputs",method:"GET"},"::create::organization::inputs":{url:urlBase+"/organizations/:id/inputs",method:"POST"},"::createMany::organization::inputs":{isArray:!0,url:urlBase+"/organizations/:id/inputs",method:"POST"},"::delete::organization::inputs":{url:urlBase+"/organizations/:id/inputs",method:"DELETE"},"::count::organization::inputs":{url:urlBase+"/organizations/:id/inputs/count",method:"GET"}});return R.updateOrCreate=R.upsert,R.update=R.updateAll,R.destroyById=R.deleteById,R.removeById=R.deleteById,R.modelName="Input",R}]),module.factory("Output",["LoopBackResource","LoopBackAuth","$injector",function(Resource,LoopBackAuth,$injector){var R=Resource(urlBase+"/outputs/:id",{id:"@id"},{create:{url:urlBase+"/outputs",method:"POST"},createMany:{isArray:!0,url:urlBase+"/outputs",method:"POST"},upsert:{url:urlBase+"/outputs",method:"PUT"},exists:{url:urlBase+"/outputs/:id/exists",method:"GET"},findById:{url:urlBase+"/outputs/:id",method:"GET"},find:{isArray:!0,url:urlBase+"/outputs",method:"GET"},findOne:{url:urlBase+"/outputs/findOne",method:"GET"},updateAll:{url:urlBase+"/outputs/update",method:"POST"},deleteById:{url:urlBase+"/outputs/:id",method:"DELETE"},count:{url:urlBase+"/outputs/count",method:"GET"},prototype$updateAttributes:{url:urlBase+"/outputs/:id",method:"PUT"},createChangeStream:{url:urlBase+"/outputs/change-stream",method:"POST"},"::findById::organization::outputs":{params:{fk:"@fk"},url:urlBase+"/organizations/:id/outputs/:fk",method:"GET"},"::destroyById::organization::outputs":{params:{fk:"@fk"},url:urlBase+"/organizations/:id/outputs/:fk",method:"DELETE"},"::updateById::organization::outputs":{params:{fk:"@fk"},url:urlBase+"/organizations/:id/outputs/:fk",method:"PUT"},"::get::organization::outputs":{isArray:!0,url:urlBase+"/organizations/:id/outputs",method:"GET"},"::create::organization::outputs":{url:urlBase+"/organizations/:id/outputs",method:"POST"},"::createMany::organization::outputs":{isArray:!0,url:urlBase+"/organizations/:id/outputs",method:"POST"},"::delete::organization::outputs":{url:urlBase+"/organizations/:id/outputs",method:"DELETE"},"::count::organization::outputs":{url:urlBase+"/organizations/:id/outputs/count",method:"GET"}});return R.updateOrCreate=R.upsert,R.update=R.updateAll,R.destroyById=R.deleteById,R.removeById=R.deleteById,R.modelName="Output",R}]),module.factory("Application",["LoopBackResource","LoopBackAuth","$injector",function(Resource,LoopBackAuth,$injector){var R=Resource(urlBase+"/applications/:id",{id:"@id"},{create:{url:urlBase+"/applications",method:"POST"},createMany:{isArray:!0,url:urlBase+"/applications",method:"POST"},upsert:{url:urlBase+"/applications",method:"PUT"},exists:{url:urlBase+"/applications/:id/exists",method:"GET"},findById:{url:urlBase+"/applications/:id",method:"GET"},find:{isArray:!0,url:urlBase+"/applications",method:"GET"},findOne:{url:urlBase+"/applications/findOne",method:"GET"},updateAll:{url:urlBase+"/applications/update",method:"POST"},deleteById:{url:urlBase+"/applications/:id",method:"DELETE"},count:{url:urlBase+"/applications/count",method:"GET"},prototype$updateAttributes:{url:urlBase+"/applications/:id",method:"PUT"},createChangeStream:{url:urlBase+"/applications/change-stream",method:"POST"},"::findById::organization::applications":{params:{fk:"@fk"},url:urlBase+"/organizations/:id/applications/:fk",method:"GET"},"::destroyById::organization::applications":{params:{fk:"@fk"},url:urlBase+"/organizations/:id/applications/:fk",method:"DELETE"},"::updateById::organization::applications":{params:{fk:"@fk"},url:urlBase+"/organizations/:id/applications/:fk",method:"PUT"},"::get::organization::applications":{isArray:!0,url:urlBase+"/organizations/:id/applications",method:"GET"},"::create::organization::applications":{url:urlBase+"/organizations/:id/applications",method:"POST"},"::createMany::organization::applications":{isArray:!0,url:urlBase+"/organizations/:id/applications",method:"POST"},"::delete::organization::applications":{url:urlBase+"/organizations/:id/applications",method:"DELETE"},"::count::organization::applications":{url:urlBase+"/organizations/:id/applications/count",method:"GET"}});return R.updateOrCreate=R.upsert,R.update=R.updateAll,R.destroyById=R.deleteById,R.removeById=R.deleteById,R.modelName="Application",R}]),module.factory("Event",["LoopBackResource","LoopBackAuth","$injector",function(Resource,LoopBackAuth,$injector){var R=Resource(urlBase+"/events/:id",{id:"@id"},{create:{url:urlBase+"/events",method:"POST"},createMany:{isArray:!0,url:urlBase+"/events",method:"POST"},upsert:{url:urlBase+"/events",method:"PUT"},exists:{url:urlBase+"/events/:id/exists",method:"GET"},findById:{url:urlBase+"/events/:id",method:"GET"},find:{isArray:!0,url:urlBase+"/events",method:"GET"},findOne:{url:urlBase+"/events/findOne",method:"GET"},updateAll:{url:urlBase+"/events/update",method:"POST"},deleteById:{url:urlBase+"/events/:id",method:"DELETE"},count:{url:urlBase+"/events/count",method:"GET"},prototype$updateAttributes:{url:urlBase+"/events/:id",method:"PUT"},createChangeStream:{url:urlBase+"/events/change-stream",method:"POST"},"::findById::organization::events":{params:{fk:"@fk"},url:urlBase+"/organizations/:id/events/:fk",method:"GET"},"::destroyById::organization::events":{params:{fk:"@fk"},url:urlBase+"/organizations/:id/events/:fk",method:"DELETE"},"::updateById::organization::events":{params:{fk:"@fk"},url:urlBase+"/organizations/:id/events/:fk",method:"PUT"},"::get::organization::events":{isArray:!0,url:urlBase+"/organizations/:id/events",method:"GET"},"::create::organization::events":{url:urlBase+"/organizations/:id/events",method:"POST"},"::createMany::organization::events":{isArray:!0,url:urlBase+"/organizations/:id/events",method:"POST"},"::delete::organization::events":{url:urlBase+"/organizations/:id/events",method:"DELETE"},"::count::organization::events":{url:urlBase+"/organizations/:id/events/count",method:"GET"}});return R.updateOrCreate=R.upsert,R.update=R.updateAll,R.destroyById=R.deleteById,R.removeById=R.deleteById,R.modelName="Event",R}]),module.factory("Visitor",["LoopBackResource","LoopBackAuth","$injector",function(Resource,LoopBackAuth,$injector){var R=Resource(urlBase+"/visitors/:id",{id:"@id"},{create:{url:urlBase+"/visitors",method:"POST"},createMany:{isArray:!0,url:urlBase+"/visitors",method:"POST"},upsert:{url:urlBase+"/visitors",method:"PUT"},exists:{url:urlBase+"/visitors/:id/exists",method:"GET"},findById:{url:urlBase+"/visitors/:id",method:"GET"},find:{isArray:!0,url:urlBase+"/visitors",method:"GET"},findOne:{url:urlBase+"/visitors/findOne",method:"GET"},updateAll:{url:urlBase+"/visitors/update",method:"POST"},deleteById:{url:urlBase+"/visitors/:id",method:"DELETE"},count:{url:urlBase+"/visitors/count",method:"GET"},prototype$updateAttributes:{url:urlBase+"/visitors/:id",method:"PUT"},createChangeStream:{url:urlBase+"/visitors/change-stream",method:"POST"},"::findById::organization::visitors":{params:{fk:"@fk"},url:urlBase+"/organizations/:id/visitors/:fk",method:"GET"},"::destroyById::organization::visitors":{params:{fk:"@fk"},url:urlBase+"/organizations/:id/visitors/:fk",method:"DELETE"},"::updateById::organization::visitors":{params:{fk:"@fk"},url:urlBase+"/organizations/:id/visitors/:fk",method:"PUT"},"::get::organization::visitors":{isArray:!0,url:urlBase+"/organizations/:id/visitors",method:"GET"},"::create::organization::visitors":{url:urlBase+"/organizations/:id/visitors",method:"POST"},"::createMany::organization::visitors":{isArray:!0,url:urlBase+"/organizations/:id/visitors",method:"POST"},"::delete::organization::visitors":{url:urlBase+"/organizations/:id/visitors",method:"DELETE"},"::count::organization::visitors":{url:urlBase+"/organizations/:id/visitors/count",method:"GET"}});return R.updateOrCreate=R.upsert,R.update=R.updateAll,R.destroyById=R.deleteById,R.removeById=R.deleteById,R.modelName="Visitor",R}]),module.factory("Analytics",["LoopBackResource","LoopBackAuth","$injector",function(Resource,LoopBackAuth,$injector){var R=Resource(urlBase+"/analytics/overview",{id:"@id"},{getOverview:{url:urlBase+"/analytics/overview",method:"GET"},getVisitor:{url:urlBase+"/analytics/visitor/:id",method:"GET"}});return R.modelName="Analytics",R}]),module.factory("Organization",["LoopBackResource","LoopBackAuth","$injector",function(Resource,LoopBackAuth,$injector){var R=Resource(urlBase+"/organizations/:id",{id:"@id"},{prototype$__findById__places:{
params:{fk:"@fk"},url:urlBase+"/organizations/:id/places/:fk",method:"GET"},prototype$__destroyById__places:{params:{fk:"@fk"},url:urlBase+"/organizations/:id/places/:fk",method:"DELETE"},prototype$__updateById__places:{params:{fk:"@fk"},url:urlBase+"/organizations/:id/places/:fk",method:"PUT"},prototype$__findById__floors:{params:{fk:"@fk"},url:urlBase+"/organizations/:id/floors/:fk",method:"GET"},prototype$__destroyById__floors:{params:{fk:"@fk"},url:urlBase+"/organizations/:id/floors/:fk",method:"DELETE"},prototype$__updateById__floors:{params:{fk:"@fk"},url:urlBase+"/organizations/:id/floors/:fk",method:"PUT"},prototype$__findById__departments:{params:{fk:"@fk"},url:urlBase+"/organizations/:id/departments/:fk",method:"GET"},prototype$__destroyById__departments:{params:{fk:"@fk"},url:urlBase+"/organizations/:id/departments/:fk",method:"DELETE"},prototype$__updateById__departments:{params:{fk:"@fk"},url:urlBase+"/organizations/:id/departments/:fk",method:"PUT"},prototype$__findById__inputs:{params:{fk:"@fk"},url:urlBase+"/organizations/:id/inputs/:fk",method:"GET"},prototype$__destroyById__inputs:{params:{fk:"@fk"},url:urlBase+"/organizations/:id/inputs/:fk",method:"DELETE"},prototype$__updateById__inputs:{params:{fk:"@fk"},url:urlBase+"/organizations/:id/inputs/:fk",method:"PUT"},prototype$__findById__outputs:{params:{fk:"@fk"},url:urlBase+"/organizations/:id/outputs/:fk",method:"GET"},prototype$__destroyById__outputs:{params:{fk:"@fk"},url:urlBase+"/organizations/:id/outputs/:fk",method:"DELETE"},prototype$__updateById__outputs:{params:{fk:"@fk"},url:urlBase+"/organizations/:id/outputs/:fk",method:"PUT"},prototype$__get__places:{isArray:!0,url:urlBase+"/organizations/:id/places",method:"GET"},prototype$__create__places:{url:urlBase+"/organizations/:id/places",method:"POST"},prototype$__delete__places:{url:urlBase+"/organizations/:id/places",method:"DELETE"},prototype$__count__places:{url:urlBase+"/organizations/:id/places/count",method:"GET"},prototype$__get__floors:{isArray:!0,url:urlBase+"/organizations/:id/floors",method:"GET"},prototype$__create__floors:{url:urlBase+"/organizations/:id/floors",method:"POST"},prototype$__delete__floors:{url:urlBase+"/organizations/:id/floors",method:"DELETE"},prototype$__count__floors:{url:urlBase+"/organizations/:id/floors/count",method:"GET"},prototype$__get__departments:{isArray:!0,url:urlBase+"/organizations/:id/departments",method:"GET"},prototype$__create__departments:{url:urlBase+"/organizations/:id/departments",method:"POST"},prototype$__delete__departments:{url:urlBase+"/organizations/:id/departments",method:"DELETE"},prototype$__count__departments:{url:urlBase+"/organizations/:id/departments/count",method:"GET"},prototype$__get__inputs:{isArray:!0,url:urlBase+"/organizations/:id/inputs",method:"GET"},prototype$__create__inputs:{url:urlBase+"/organizations/:id/inputs",method:"POST"},prototype$__delete__inputs:{url:urlBase+"/organizations/:id/inputs",method:"DELETE"},prototype$__count__inputs:{url:urlBase+"/organizations/:id/inputs/count",method:"GET"},prototype$__get__outputs:{isArray:!0,url:urlBase+"/organizations/:id/outputs",method:"GET"},prototype$__create__outputs:{url:urlBase+"/organizations/:id/outputs",method:"POST"},prototype$__delete__outputs:{url:urlBase+"/organizations/:id/outputs",method:"DELETE"},prototype$__count__outputs:{url:urlBase+"/organizations/:id/outputs/count",method:"GET"},create:{url:urlBase+"/organizations",method:"POST"},createMany:{isArray:!0,url:urlBase+"/organizations",method:"POST"},upsert:{url:urlBase+"/organizations",method:"PUT"},exists:{url:urlBase+"/organizations/:id/exists",method:"GET"},findById:{url:urlBase+"/organizations/:id",method:"GET"},find:{isArray:!0,url:urlBase+"/organizations",method:"GET"},findOne:{url:urlBase+"/organizations/findOne",method:"GET"},updateAll:{url:urlBase+"/organizations/update",method:"POST"},deleteById:{url:urlBase+"/organizations/:id",method:"DELETE"},count:{url:urlBase+"/organizations/count",method:"GET"},prototype$updateAttributes:{url:urlBase+"/organizations/:id",method:"PUT"},createChangeStream:{url:urlBase+"/organizations/change-stream",method:"POST"},prototype$__findById__places__floors:{params:{nk:"@nk",fk:"@fk"},url:urlBase+"/organizations/:id/places/:nk/floors/:fk",method:"GET"},prototype$__destroyById__places__floors:{params:{nk:"@nk",fk:"@fk"},url:urlBase+"/organizations/:id/places/:nk/floors/:fk",method:"DELETE"},prototype$__updateById__places__floors:{params:{nk:"@nk",fk:"@fk"},url:urlBase+"/organizations/:id/places/:nk/floors/:fk",method:"PUT"},prototype$__findById__places__departments:{params:{nk:"@nk",fk:"@fk"},url:urlBase+"/organizations/:id/places/:nk/departments/:fk",method:"GET"},prototype$__destroyById__places__departments:{params:{nk:"@nk",fk:"@fk"},url:urlBase+"/organizations/:id/places/:nk/departments/:fk",method:"DELETE"},prototype$__updateById__places__departments:{params:{nk:"@nk",fk:"@fk"},url:urlBase+"/organizations/:id/places/:nk/departments/:fk",method:"PUT"},prototype$__get__places__organization:{params:{nk:"@nk"},url:urlBase+"/organizations/:id/places/:nk/organization",method:"GET"},prototype$__get__places__floors:{isArray:!0,params:{nk:"@nk"},url:urlBase+"/organizations/:id/places/:nk/floors",method:"GET"},prototype$__create__places__floors:{params:{nk:"@nk"},url:urlBase+"/organizations/:id/places/:nk/floors",method:"POST"},prototype$__delete__places__floors:{params:{nk:"@nk"},url:urlBase+"/organizations/:id/places/:nk/floors",method:"DELETE"},prototype$__count__places__floors:{params:{nk:"@nk"},url:urlBase+"/organizations/:id/places/:nk/floors/count",method:"GET"},prototype$__get__places__departments:{isArray:!0,params:{nk:"@nk"},url:urlBase+"/organizations/:id/places/:nk/departments",method:"GET"},prototype$__create__places__departments:{params:{nk:"@nk"},url:urlBase+"/organizations/:id/places/:nk/departments",method:"POST"},prototype$__delete__places__departments:{params:{nk:"@nk"},url:urlBase+"/organizations/:id/places/:nk/departments",method:"DELETE"},prototype$__count__places__departments:{params:{nk:"@nk"},url:urlBase+"/organizations/:id/places/:nk/departments/count",method:"GET"},prototype$__findById__floors__departments:{params:{nk:"@nk",fk:"@fk"},url:urlBase+"/organizations/:id/floors/:nk/departments/:fk",method:"GET"},prototype$__destroyById__floors__departments:{params:{nk:"@nk",fk:"@fk"},url:urlBase+"/organizations/:id/floors/:nk/departments/:fk",method:"DELETE"},prototype$__updateById__floors__departments:{params:{nk:"@nk",fk:"@fk"},url:urlBase+"/organizations/:id/floors/:nk/departments/:fk",method:"PUT"},prototype$__get__floors__organization:{params:{nk:"@nk"},url:urlBase+"/organizations/:id/floors/:nk/organization",method:"GET"},prototype$__get__floors__departments:{isArray:!0,params:{nk:"@nk"},url:urlBase+"/organizations/:id/floors/:nk/departments",method:"GET"},prototype$__create__floors__departments:{params:{nk:"@nk"},url:urlBase+"/organizations/:id/floors/:nk/departments",method:"POST"},prototype$__delete__floors__departments:{params:{nk:"@nk"},url:urlBase+"/organizations/:id/floors/:nk/departments",method:"DELETE"},prototype$__count__floors__departments:{url:urlBase+"/organizations/:id/floors/:nk/departments/count",method:"GET"},"::get::place::organization":{url:urlBase+"/places/:id/organization",method:"GET"},"::get::floor::organization":{url:urlBase+"/floors/:id/organization",method:"GET"}});return R.updateOrCreate=R.upsert,R.update=R.updateAll,R.destroyById=R.deleteById,R.removeById=R.deleteById,R.modelName="Organization",R.places=function(){var TargetResource=$injector.get("Place"),action=TargetResource["::get::organization::places"];return action.apply(R,arguments)},R.places.count=function(){var TargetResource=$injector.get("Place"),action=TargetResource["::count::organization::places"];return action.apply(R,arguments)},R.places.create=function(){var TargetResource=$injector.get("Place"),action=TargetResource["::create::organization::places"];return action.apply(R,arguments)},R.places.createMany=function(){var TargetResource=$injector.get("Place"),action=TargetResource["::createMany::organization::places"];return action.apply(R,arguments)},R.places.destroyAll=function(){var TargetResource=$injector.get("Place"),action=TargetResource["::delete::organization::places"];return action.apply(R,arguments)},R.places.destroyById=function(){var TargetResource=$injector.get("Place"),action=TargetResource["::destroyById::organization::places"];return action.apply(R,arguments)},R.places.findById=function(){var TargetResource=$injector.get("Place"),action=TargetResource["::findById::organization::places"];return action.apply(R,arguments)},R.places.updateById=function(){var TargetResource=$injector.get("Place"),action=TargetResource["::updateById::organization::places"];return action.apply(R,arguments)},R.floors=function(){var TargetResource=$injector.get("Floor"),action=TargetResource["::get::organization::floors"];return action.apply(R,arguments)},R.floors.count=function(){var TargetResource=$injector.get("Floor"),action=TargetResource["::count::organization::floors"];return action.apply(R,arguments)},R.floors.create=function(){var TargetResource=$injector.get("Floor"),action=TargetResource["::create::organization::floors"];return action.apply(R,arguments)},R.floors.createMany=function(){var TargetResource=$injector.get("Floor"),action=TargetResource["::createMany::organization::floors"];return action.apply(R,arguments)},R.floors.destroyAll=function(){var TargetResource=$injector.get("Floor"),action=TargetResource["::delete::organization::floors"];return action.apply(R,arguments)},R.floors.destroyById=function(){var TargetResource=$injector.get("Floor"),action=TargetResource["::destroyById::organization::floors"];return action.apply(R,arguments)},R.floors.findById=function(){var TargetResource=$injector.get("Floor"),action=TargetResource["::findById::organization::floors"];return action.apply(R,arguments)},R.floors.updateById=function(){var TargetResource=$injector.get("Floor"),action=TargetResource["::updateById::organization::floors"];return action.apply(R,arguments)},R.departments=function(){var TargetResource=$injector.get("Department"),action=TargetResource["::get::organization::departments"];return action.apply(R,arguments)},R.departments.count=function(){var TargetResource=$injector.get("Department"),action=TargetResource["::count::organization::departments"];return action.apply(R,arguments)},R.departments.create=function(){var TargetResource=$injector.get("Department"),action=TargetResource["::create::organization::departments"];return action.apply(R,arguments)},R.departments.createMany=function(){var TargetResource=$injector.get("Department"),action=TargetResource["::createMany::organization::departments"];return action.apply(R,arguments)},R.departments.destroyAll=function(){var TargetResource=$injector.get("Department"),action=TargetResource["::delete::organization::departments"];return action.apply(R,arguments)},R.departments.destroyById=function(){var TargetResource=$injector.get("Department"),action=TargetResource["::destroyById::organization::departments"];return action.apply(R,arguments)},R.departments.findById=function(){var TargetResource=$injector.get("Department"),action=TargetResource["::findById::organization::departments"];return action.apply(R,arguments)},R.departments.updateById=function(){var TargetResource=$injector.get("Department"),action=TargetResource["::updateById::organization::departments"];return action.apply(R,arguments)},R.inputs=function(){var TargetResource=$injector.get("Input"),action=TargetResource["::get::organization::inputs"];return action.apply(R,arguments)},R.inputs.count=function(){var TargetResource=$injector.get("Input"),action=TargetResource["::count::organization::inputs"];return action.apply(R,arguments)},R.inputs.create=function(){var TargetResource=$injector.get("Input"),action=TargetResource["::create::organization::inputs"];return action.apply(R,arguments)},R.inputs.createMany=function(){var TargetResource=$injector.get("Input"),action=TargetResource["::createMany::organization::inputs"];return action.apply(R,arguments)},R.inputs.destroyAll=function(){var TargetResource=$injector.get("Input"),action=TargetResource["::delete::organization::inputs"];return action.apply(R,arguments)},R.inputs.destroyById=function(){var TargetResource=$injector.get("Input"),action=TargetResource["::destroyById::organization::inputs"];return action.apply(R,arguments)},R.inputs.findById=function(){var TargetResource=$injector.get("Input"),action=TargetResource["::findById::organization::inputs"];return action.apply(R,arguments)},R.inputs.updateById=function(){var TargetResource=$injector.get("Input"),action=TargetResource["::updateById::organization::inputs"];return action.apply(R,arguments)},R.outputs=function(){var TargetResource=$injector.get("Output"),action=TargetResource["::get::organization::outputs"];return action.apply(R,arguments)},R.outputs.count=function(){var TargetResource=$injector.get("Output"),action=TargetResource["::count::organization::outputs"];return action.apply(R,arguments)},R.outputs.create=function(){var TargetResource=$injector.get("Output"),action=TargetResource["::create::organization::outputs"];return action.apply(R,arguments)},R.outputs.createMany=function(){var TargetResource=$injector.get("Output"),action=TargetResource["::createMany::organization::outputs"];return action.apply(R,arguments)},R.outputs.destroyAll=function(){var TargetResource=$injector.get("Output"),action=TargetResource["::delete::organization::outputs"];return action.apply(R,arguments)},R.outputs.destroyById=function(){var TargetResource=$injector.get("Output"),action=TargetResource["::destroyById::organization::outputs"];return action.apply(R,arguments)},R.outputs.findById=function(){var TargetResource=$injector.get("Output"),action=TargetResource["::findById::organization::outputs"];return action.apply(R,arguments)},R.outputs.updateById=function(){var TargetResource=$injector.get("Output"),action=TargetResource["::updateById::organization::outputs"];return action.apply(R,arguments)},R}]),module.factory("LoopBackAuth",function(){function LoopBackAuth(){var self=this;props.forEach(function(name){self[name]=load(name)}),this.currentUserData=null}function save(storage,name,value){var key=propsPrefix+name;null==value&&(value=""),storage[key]=value}function load(name){var key=propsPrefix+name;return localStorage[key]||sessionStorage[key]||null}var props=["authorizationToken","apiKey","currentUserId","rememberMe"],propsPrefix="$LoopBack$";return LoopBackAuth.prototype.save=function(){var self=this,storage=this.rememberMe?localStorage:sessionStorage;props.forEach(function(name){save(storage,name,self[name])})},LoopBackAuth.prototype.setUser=function(authorizationToken,userData){this.authorizationToken=authorizationToken,this.currentUserId=userData.id,this.currentUserData=userData,this.currentUser=userData},LoopBackAuth.prototype.clearUser=function(){this.authorizationToken=null,this.apiKey=null,this.currentUserId=null,this.currentUserData=null},LoopBackAuth.prototype.clearStorage=function(){props.forEach(function(name){save(sessionStorage,name,null),save(localStorage,name,null)})},new LoopBackAuth}).config(["$httpProvider",function($httpProvider){$httpProvider.interceptors.push("LoopBackAuthRequestInterceptor")}]).factory("LoopBackAuthRequestInterceptor",["$q","LoopBackAuth",function($q,LoopBackAuth){return{request:function(config){var host=getHost(config.url);if(host&&host!==urlBaseHost)return config;if(LoopBackAuth.authorizationToken)config.headers.Authorization="Bearer "+LoopBackAuth.authorizationToken;else if(config.__isGetCurrentUser__){var res={body:{error:{status:401}},status:401,config:config,headers:function(){return undefined}};return $q.reject(res)}return config||$q.when(config)}}}]).provider("LoopBackResource",function(){this.setAuthHeader=function(header){authHeader=header},this.setUrlBase=function(url){urlBase=url,urlBaseHost=getHost(urlBase)||location.host},this.getUrlBase=function(){return urlBase},this.$get=["$resource",function($resource){return function(url,params,actions){var resource=$resource(url,params,actions);return resource.prototype.$save=function(success,error){var result=resource.upsert.call(this,{},this,success,error);return result.$promise||result},resource}}]})}(window,window.angular),app.factory("AuthService",["User","$q","$rootScope","$http",function(User,$q,$rootScope,$http){function login(credentials){return User.login({email:credentials.email,password:credentials.password}).$promise.then(function(response){response.user.organization=response.organization,console.log("user login response",response)})}function logout(){return User.logout().$promise.then(function(){$rootScope.currentUser=null})}function register(credentials){return console.log("register function",credentials),User.register({first_name:credentials.first_name,last_name:credentials.last_name,email:credentials.email,company:credentials.company,country:credentials.country,background:credentials.background,password:credentials.pass}).$promise.then(function(res){console.log("register response",res)},function(res){console.log(res)})}function isAuthenticated(){return User.isAuthenticated()}function getCurrentUser(){return User.getCurrent()}return{login:login,logout:logout,register:register,isAuthenticated:isAuthenticated,getCurrentUser:getCurrentUser}}]),app.factory("EventsService",["FBURL","Event",function(FBURL,Event){function create(organization,type,target,operation){return Event.create({data:{type:type,target:target,operation:operation},event:"config-changed",organization_id:organization},function(res){console.log(res)},function(res){console.log(res)})}new Firebase(FBURL);return{create:create}}]),app.filter("showKey",function(){return function(input){var out,i;for(i in input)out=Object.keys(input[i])[0];return out}}),app.directive("navCollapse",function(){return{restrict:"A",link:function($scope,$el){var $dropdowns=$el.find("ul").parent("li"),$a=$dropdowns.children("a"),$notDropdowns=$el.children("li").not($dropdowns),$notDropdownsLinks=$notDropdowns.children("a"),app=angular.element("#proximiioApp"),sidebar=angular.element("#sidebar"),controls=angular.element("#controls");$dropdowns.addClass("dropdown");var $submenus=$dropdowns.find("ul >.dropdown");$submenus.addClass("submenu"),$a.append('<i class="fa fa-plus"></i>'),$a.on("click",function(event){if(app.hasClass("sidebar-sm")||app.hasClass("sidebar-xs")||app.hasClass("hz-menu"))return!1;var $this=angular.element(this),$parent=$this.parent("li"),$openSubmenu=angular.element(".submenu.open");$parent.hasClass("submenu")||$dropdowns.not($parent).removeClass("open").find("ul").slideUp(),$openSubmenu.not($this.parents(".submenu")).removeClass("open").find("ul").slideUp(),$parent.toggleClass("open").find(">ul").stop().slideToggle(),event.preventDefault()}),$dropdowns.on("mouseenter",function(){sidebar.addClass("dropdown-open"),controls.addClass("dropdown-open")}),$dropdowns.on("mouseleave",function(){sidebar.removeClass("dropdown-open"),controls.removeClass("dropdown-open")}),$notDropdownsLinks.on("click",function(){$dropdowns.removeClass("open").find("ul").slideUp()});var $activeDropdown=angular.element(".dropdown>ul>.active").parent();$activeDropdown.css("display","block")}}}),app.directive("ripple",function(){return{restrict:"A",link:function(scope,element){var parent,ink,d,x,y;angular.element(element).find(">li>a").click(function(e){parent=angular.element(this).parent(),0===parent.find(".ink").length&&parent.prepend('<span class="ink"></span>'),ink=parent.find(".ink"),ink.removeClass("animate"),ink.height()||ink.width()||(d=Math.max(parent.outerWidth(),parent.outerHeight()),ink.css({height:d,width:d})),x=e.pageX-parent.offset().left-ink.width()/2,y=e.pageY-parent.offset().top-ink.height()/2,ink.css({top:y+"px",left:x+"px"}).addClass("animate"),setTimeout(function(){angular.element(".ink").remove()},600)})}}}),app.directive("collapseSidebar",["$rootScope",function($rootScope){return{restrict:"A",link:function(scope,element){var app=angular.element("#proximiioApp"),$window=angular.element(window),width=$window.width(),removeRipple=function(){angular.element("#sidebar").find(".ink").remove()},collapse=function(){width=$window.width(),992>width?app.addClass("sidebar-xs"):app.removeClass("sidebar-xs")};collapse(),$window.resize(function(){if(width!==$window.width()){var t;clearTimeout(t),t=setTimeout(collapse,300),removeRipple()}}),element.on("click",function(e){app.hasClass("sidebar-xs")?app.removeClass("sidebar-xs"):app.addClass("sidebar-xs"),removeRipple(),e.preventDefault()})}}}]),app.directive("tileControlClose",function(){return{restrict:"A",link:function(scope,element){var tile=element.parents(".tile");element.on("click",function(){tile.addClass("closed").fadeOut()})}}}),app.directive("tileControlFullscreen",function(){return{restrict:"A",link:function(scope,element){var dropdown=element.parents(".dropdown");element.on("click",function(){dropdown.trigger("click")})}}}),app.directive("tileControlRefresh",function(){return{restrict:"A",link:function(scope,element){var tile=element.parents(".tile"),dropdown=element.parents(".dropdown");element.on("click",function(){tile.addClass("refreshing"),dropdown.trigger("click")})}}}),app.directive("tileControlToggle",function(){return{restrict:"A",link:function(scope,element){var tile=element.parents(".tile");element.on("click",function(){tile.toggleClass("collapsed"),tile.children().not(".tile-header").slideToggle(150)})}}}),app.directive("morrisLineChart",function(){return{restrict:"A",scope:{lineData:"=",lineXkey:"@",lineYkeys:"@",lineLabels:"@",lineColors:"@"},link:function(scope,elem,attrs){var colors,morris;colors=void 0===scope.lineColors||""===scope.lineColors?null:JSON.parse(scope.lineColors),scope.$watch("lineData",function(){scope.lineData&&(morris?morris.setData(scope.lineData):morris=new Morris.Line({element:elem,data:scope.lineData,xkey:scope.lineXkey,ykeys:JSON.parse(scope.lineYkeys),labels:JSON.parse(scope.lineLabels),lineColors:colors||["#0b62a4","#7a92a3","#4da74d","#afd8f8","#edc240","#cb4b4b","#9440ed"],resize:!0}))})}}}).directive("morrisAreaChart",function(){return{restrict:"A",scope:{lineData:"=",lineXkey:"@",lineYkeys:"@",lineLabels:"@",lineColors:"@",lineWidth:"@",fillOpacity:"@",showGrid:"@"},link:function(scope,elem,attrs){var colors,morris;colors=void 0===scope.lineColors||""===scope.lineColors?null:JSON.parse(scope.lineColors),scope.$watch("lineData",function(){scope.lineData&&(morris?morris.setData(scope.lineData):morris=new Morris.Area({element:elem,data:scope.lineData,xkey:scope.lineXkey,ykeys:JSON.parse(scope.lineYkeys),labels:JSON.parse(scope.lineLabels),lineColors:colors||["#0b62a4","#7a92a3","#4da74d","#afd8f8","#edc240","#cb4b4b","#9440ed"],lineWidth:scope.lineWidth||"0",fillOpacity:scope.fillOpacity||"0.8",grid:scope.showGrid||!1,resize:!0}))})}}}).directive("morrisBarChart",["DonutSegment",function(DonutSegment){return{restrict:"A",scope:{barData:"=",barXkey:"@",barYkeys:"@",barLabels:"@",barColors:"@"},link:function(scope,elem,attrs){var colors,morris;colors=void 0===scope.barColors||""===scope.barColors?null:JSON.parse(scope.barColors),scope.$watch("barData",function(){scope.barData&&(morris?morris.setData(scope.barData):morris=new Morris.Bar({element:elem,data:scope.barData,xkey:scope.barXkey,ykeys:JSON.parse(scope.barYkeys),labels:JSON.parse(scope.barLabels),barColors:colors||["#0b62a4","#7a92a3","#4da74d","#afd8f8","#edc240","#cb4b4b","#9440ed"],xLabelMargin:2,resize:!0}))})}}}]).directive("morrisDonutChart",function(){return{restrict:"A",scope:{donutData:"=",donutColors:"@"},link:function(scope,elem,attrs){var colors;colors=void 0===scope.donutColors||""===scope.donutColors?null:JSON.parse(scope.donutColors),scope.$watchCollection("donutData",function(){scope.donutData&&(scope.objDonut?scope.objDonut.setData(scope.donutData):scope.objDonut=new Morris.Donut({element:elem,data:scope.donutData,colors:colors||["#0B62A4","#3980B5","#679DC6","#95BBD7","#B0CCE1","#095791","#095085","#083E67","#052C48","#042135"],resize:!0}))})}}}),app.directive("slimscroll",function(){return{restrict:"A",link:function($scope,$el,$attr){var option={},refresh=function(){$attr.slimscroll?option=$scope.$eval($attr.slimscroll):$attr.slimscrollOption&&(option=$scope.$eval($attr.slimscrollOption)),$el.slimscroll({destroy:!0}),$el.slimscroll(option)};refresh();var collapseBtn=angular.element(".sidebar-collapse"),$window=angular.element(window),sidebar=angular.element("#sidebar"),checkScrollbar=function(){refresh(),angular.element("#sidebar .slimScrollBar").is(":visible")?sidebar.removeClass("scroll-inactive"):sidebar.addClass("scroll-inactive")};collapseBtn.on("click",function(){checkScrollbar()}),$window.resize(function(){checkScrollbar()}),$attr.slimscroll&&!option.noWatch&&$scope.$watchCollection($attr.slimscroll,refresh),$attr.slimscrollWatch&&$scope.$watchCollection($attr.slimscrollWatch,refresh),$attr.slimssrollListenTo&&$scope.on($attr.slimscrollListenTo,refresh)}}}),app.directive("postRender",["$timeout",function($timeout){var def={restrict:"A",terminal:!0,transclude:!0,link:function(scope,element,attrs){scope.redraw=function(){jsPlumb.repaintEverything()},$timeout(scope.redraw,0)}};return def}]).directive("plumbItem",["$timeout",function($timeout){return{replace:!0,controller:"PlumbCtrl",link:function(scope,element,attrs){console.log("Add plumbing for the 'item' element"),jsPlumb.draggable(element,{containment:"parent"});var connectorPaintStyle={lineWidth:4,strokeStyle:"#61B7CF",joinstyle:"round",outlineColor:"white",outlineWidth:2},connectorHoverStyle={lineWidth:4,strokeStyle:"#216477",outlineWidth:2,outlineColor:"white"},endpointHoverStyle={fillStyle:"#216477",strokeStyle:"#216477"},sourceEndpoint={endpoint:"Dot",paintStyle:{strokeStyle:"#7AB02C",fillStyle:"transparent",radius:8,lineWidth:2},isSource:!0,connector:["Flowchart",{stub:[40,60],gap:10,cornerRadius:5,alwaysRespectStubs:!0}],connectorStyle:connectorPaintStyle,hoverPaintStyle:endpointHoverStyle,connectorHoverStyle:connectorHoverStyle,dragOptions:{},overlays:[["Label",{location:[.5,1.5],label:"Drag",cssClass:"endpointSourceLabel"}]]},targetEndpoint={endpoint:"Dot",paintStyle:{strokeStyle:"#7AB02C",fillStyle:"#7AB02C",radius:8,lineWidth:2},hoverPaintStyle:endpointHoverStyle,maxConnections:-1,dropOptions:{hoverClass:"hover",activeClass:"active"},isTarget:!0,overlays:[["Label",{location:[.5,-.5],label:"Drop",cssClass:"endpointTargetLabel"}]]};scope.redraw=function(){element.hasClass("output")?(jsPlumb.addEndpoint(element,{anchor:"Right",uuid:null},sourceEndpoint),jsPlumb.addEndpoint(element,{anchor:"Left",uuid:null},targetEndpoint)):element.hasClass("endpoint")?jsPlumb.addEndpoint(element,{anchor:"Left",uuid:null},targetEndpoint):jsPlumb.addEndpoint(element,{anchor:"Right",uuid:null},sourceEndpoint),jsPlumb.repaintEverything()},$timeout(scope.redraw,0),element.bind("dblclick",function(e){jsPlumb.detachAllConnections($(this)),$(this).remove(),e.stopPropagation(),scope.$parent.removeState(attrs.identifier),scope.$parent.$digest()})}}}]).directive("plumbMenuItem",function(){return{replace:!0,controller:"PlumbCtrl",link:function(scope,element,attrs){console.log("Add plumbing for the 'menu-item' element"),jsPlumb.draggable(element,{containment:element.parent().parent()})}}}).directive("plumbDrag",function(){return{replace:!0,link:function(scope,element,attrs){console.log("Add plumbing for the 'connect' element");var common={anchor:["bottom",{shape:"triangle"}],connector:"Straight",endpoint:["Dot",{radius:8}],paintStyle:{fillStyle:"#a2d200"},hoverPaintStyle:{fillStyle:"#86ae00"},connectorStyle:{strokeStyle:"#a2d200",lineWidth:2},connectorHoverStyle:{lineWidth:2}};jsPlumb.makeSource(element,{parent:$(element).parent()},common)}}}).directive("plumbDrop",function(){return{replace:!0,link:function(scope,element,attrs){console.log("Add plumbing for the 'connect' element");var common={connector:"Straight",endpoint:"Dot",paintStyle:{fillStyle:"white",outlineColor:"blue",outlineWidth:1},hoverPaintStyle:{fillStyle:"lightblue"},connectorStyle:{strokeStyle:"blue",lineWidth:1},connectorHoverStyle:{lineWidth:2}};jsPlumb.makeTarget(element,{parent:$(element).parent()},common)}}}).directive("droppable",["$compile",function($compile){return{restrict:"A",link:function(scope,element,attrs){console.log("Make this element droppable"),element.droppable({drop:function(event,ui){var dragIndex=angular.element(ui.draggable).data("identifier"),dragEl=angular.element(ui.draggable),dropEl=angular.element(this);if(dragEl.hasClass("menu-item")&&dropEl.hasClass("drop-container")){console.log("Drag event on "+dragIndex);var x=event.pageX-scope.module_css.width/2,y=event.pageY-scope.module_css.height/2;scope.addModuleToSchema(dragIndex,x,y)}scope.$apply()}})}}}]).directive("draggable",function(){return{restrict:"A",link:function(scope,element,attrs){console.log("Let draggable item snap back to previous position"),element.draggable({revert:!0})}}}),app.directive("countTo",["$timeout",function($timeout){return{replace:!1,scope:!0,link:function(scope,element,attrs){var num,refreshInterval,duration,steps,step,countTo,increment,precision,format,e=element[0],calculate=function(){refreshInterval=30,step=0,scope.timoutId=null,precision=parseInt(attrs.precision)||0,countTo=parseFloat(attrs.countTo)||0,scope.value=parseFloat(attrs.value,10)||0,duration=1e3*parseFloat(attrs.duration)||0,steps=duration/refreshInterval,increment=(countTo-scope.value)/steps,num=scope.value,format="comma"===attrs.format?function(number){return number.toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")}:function(number){return number}},tick=function(){scope.timoutId=$timeout(function(){num+=increment,step++,step>=steps?($timeout.cancel(scope.timoutId),num=countTo,e.textContent=format(countTo.toFixed(precision))):(e.textContent=format(num.toFixed(precision)),tick())},refreshInterval)},start=function(){scope.timoutId&&$timeout.cancel(scope.timoutId),calculate(),tick()};return attrs.$observe("countTo",function(val){val&&start()}),attrs.$observe("value",function(val){start()}),!0}}}]),app.directive("stripeCheckout",[function(){return{replace:!1,scope:!0,link:function(scope,element,attrs){}}}]),app.directive("daterangepicker",["$compile","$parse",function($compile,$parse){return{restrict:"AC",require:"?ngModel",link:function($scope,$element,$attributes,ngModel){var format,formatted,options;return format=function(date){return date.format(options.format)},formatted=function(dates){return[format(dates.startDate),format(dates.endDate)].join(options.separator)},options={},options.format=$attributes.format||"MMM D, YYYY",options.separator=$attributes.separator||" - ",options.opens=$attributes.opens||"left",options.minDate=$attributes.minDate&&moment($attributes.minDate),options.maxDate=$attributes.maxDate&&moment($attributes.maxDate),options.dateLimit=$attributes.limit&&moment.duration.apply(this,$attributes.limit.split(" ").map(function(elem,index){return 0===index&&parseInt(elem,10)||elem})),options.ranges=$attributes.ranges&&$parse($attributes.ranges)($scope),ngModel.$formatters.unshift(function(modelValue){return modelValue?modelValue:""}),ngModel.$parsers.unshift(function(viewValue){return viewValue}),ngModel.$render=function(){return ngModel.$viewValue&&ngModel.$viewValue.startDate?$element.find("span").html(formatted(ngModel.$viewValue)):void 0},$scope.$watch($attributes.ngModel,function(modelValue){$element.data("daterangepicker").startDate=modelValue.startDate,$element.data("daterangepicker").endDate=modelValue.endDate,$element.data("daterangepicker").minDate=modelValue.minDate,$element.data("daterangepicker").maxDate=modelValue.maxDate,$element.data("daterangepicker").updateView(),$element.data("daterangepicker").updateCalendars(),angular.element($element).each(function(){var value=angular.element(this).val(),size=value.length;
size=2*size,angular.element(this).css("width",3*size+60)})}),$element.daterangepicker(options,function(start,end){return $scope.$apply(function(){return ngModel.$setViewValue({startDate:start,endDate:end}),ngModel.$render()})})}}}]),app.directive("popoverHtmlUnsafePopup",function(){return{restrict:"EA",replace:!0,scope:{title:"@",content:"@",placement:"@",animation:"&",isOpen:"&"},templateUrl:"popover-html-unsafe-popup.html"}}).directive("popoverHtmlUnsafe",["$tooltip",function($tooltip){return $tooltip("popoverHtmlUnsafe","popover","click")}]),app.directive("capitalize",function(){return{require:"ngModel",link:function(scope,element,attrs,modelCtrl){var capitalize=function(inputValue){void 0===inputValue&&(inputValue="");var capitalized=inputValue.toUpperCase();return capitalized!==inputValue&&(modelCtrl.$setViewValue(capitalized),modelCtrl.$render()),capitalized};modelCtrl.$parsers.push(capitalize),capitalize(scope[attrs.ngModel])}}}),angular.module("decipher.tags.templates",["templates/tags.html","templates/tag.html"]),angular.module("templates/tags.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("templates/tags.html",'<div class="decipher-tags form-control" data-ng-mousedown="selectArea()">\n\n  <div class="decipher-tags-taglist">\n    <span data-ng-repeat="tag in tags|orderBy:orderBy"\n          data-ng-mousedown="$event.stopPropagation()">\n      <ng-include src="options.tagTemplateUrl"></ng-include>\n    </span>\n  </div>\n\n  <span data-ng-show="toggles.inputActive">\n    <input ng-if="!srcTags.length"\n           type="text"\n           data-ng-model="inputTag"\n           class="decipher-tags-input"/>\n    <!-- may want to fiddle with limitTo here, but it was inhibiting my results\n    so perhaps there is another way -->\n    <input ng-if="srcTags.length"\n           type="text"\n           data-ng-model="inputTag"\n           class="decipher-tags-input"\n           data-typeahead="stag as stag.name for stag in srcTags|filter:$viewValue|orderBy:orderBy"\n           data-typeahead-input-formatter="{{typeaheadOptions.inputFormatter}}"\n           data-typeahead-loading="{{typeaheadOptions.loading}}"\n           data-typeahead-min-length="{{typeaheadOptions.minLength}}"\n           data-typeahead-template-url="{{typeaheadOptions.templateUrl}}"\n           data-typeahead-wait-ms="{{typeaheadOptions.waitMs}}"\n\n           data-typeahead-editable="{{typeaheadOptions.allowsEditable}}"\n           data-typeahead-on-select="add($item) && selectArea() && typeaheadOptions.onSelect()"\n        />\n\n  </span>\n</div>\n')}]),angular.module("templates/tag.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("templates/tag.html",'<span class="decipher-tags-tag"\n      data-ng-class="getClasses(tag)">{{tag.name}}\n      <i class="fa fa-remove"\n         data-ng-click="remove(tag)">\n      </i>\n</span>\n')}]),L.Icon.Default.imagePath="styles/images",angular.module("ez.datetime").run(["$templateCache",function($templateCache){$templateCache.put("ez_datetime_range_modal.html",'<div class="ez-datetime-modal"><div class="modal-header"><button type="button" class="close" ng-click="dismiss()"><span>×</span></button><h4 class="modal-title"><i class="{{ options.headingIcon }}"></i> {{ options.rangeHeadingText }}</h4></div><div class="modal-body"><div class="row"><div class="range-from col-lg-6 col-md-6 col-sm-6"><div ez-date-picker ng-model="form.from" max-date="form.maxDate" to="form.to" options="options"></div></div><div class="range-to col-lg-6 col-md-6 col-sm-6"><div ez-date-picker ng-model="form.to" min-date="form.minDate" from="form.from" options="options"></div></div></div></div><div class="modal-footer"><div class="left-btn-group"><span class="quick-select dropdown dropup" ng-if="options.shortcutsEnabled && shortcuts.length > 0"><button class="btn btn-default dropdown-toggle" data-toggle="dropdown" aria-expanded="false"><i class="{{ options.shortcutBtnIcon }}"></i> {{ options.shortcutBtnText }} <span class="caret"></span></button><ul class="dropdown-menu"><li ng-repeat="shortcut in shortcuts"><a ng-click="select($index)">{{ shortcut.name }}</a></li></ul></span> <a class="btn btn-default clear-btn" title="Clear Date" ng-click="clear()" ng-if="!!form.from || !!form.to"><span class="{{ options.clearBtnIcon }}"></span></a></div><a class="btn btn-default" ng-click="dismiss()"><i class="{{ options.cancelBtnIcon }}"></i> {{ options.cancelBtnText }}</a> <a class="btn btn-primary" ng-click="ok()"><i class="{{ options.okBtnIcon }}"></i> {{ options.okBtnText }}</a></div></div>')}]),app.run(["$templateCache",function($templateCache){$templateCache.put("popover-html-unsafe-popup.html",'<div class="popover {{placement}}" ng-class="{ in: isOpen(), fade: animation() }"><div class="arrow"></div> <div class="popover-inner"><h3 class="popover-title" ng-bind="title" ng-show="title"></h3><div class="popover-content" bind-html-unsafe="content"></div></div></div>')}]);